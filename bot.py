# -*- coding: utf-8 -*- #

import discord
from discord.ext import commands,tasks
import json
import random
import wikipedia
import wikidata.client
from PIL import Image, ImageDraw, ImageFont
import time
import asyncio
import datetime
import pickle
import sys
import platform
import re
from twitter import *
from dateutil.relativedelta import relativedelta as rdelta
import traceback
import os
import shutil
import pytz
import sqlite3
import aiohttp

#textto etc
import m10s_util as ut
from apple_util import AppleUtil
from l10n import TranslateHandler, LocalizedContext
#tokens
import config
#cog
from cogs import m10s_music
from cogs import m10s_info
from cogs import m10s_owner
from cogs import m10s_settings
from cogs import m10s_manage
from cogs import m10s_levels
from cogs import m10s_tests
from cogs import m10s_gcoms
from cogs import m10s_search
from cogs import m10s_other
from cogs import m10s_games
from cogs import P143_jyanken
from cogs import nekok500_mee6
from cogs import syouma
from cogs import pf9_symmetry
from cogs import apple_foc
from cogs import m10s_gban
from cogs import m10s_bmail
from cogs import m10s_auth_wiz

"""import logging

logging.basicConfig(level=logging.DEBUG)"""

bot = commands.Bot(command_prefix="s-",status=discord.Status.invisible)
bot.owner_id = 404243934210949120

bot.team_sina = config.team_sina

#ãƒˆãƒ¼ã‚¯ãƒ³ãŸã¡
bot.DROP_TOKEN = config.DROP_TOKEN
bot.BOT_TEST_TOKEN = config.BOT_TEST_TOKEN
bot.BOT_TOKEN = config.BOT_TOKEN
bot.NAPI_TOKEN = config.NAPI_TOKEN
bot.GAPI_TOKEN = config.GAPI_TOKEN
bot.T_API_key = config.T_API_key
bot.T_API_SKey = config.T_API_SKey
bot.T_Acs_Token = config.T_Acs_Token
bot.T_Acs_SToken = config.T_Acs_SToken


#test
postcount={}

sqlite3.register_converter('pickle', pickle.loads)
sqlite3.register_converter('json', json.loads)
sqlite3.register_adapter(dict, json.dumps)
sqlite3.register_adapter(list, pickle.dumps)
db = sqlite3.connect("sina_datas.db",detect_types=sqlite3.PARSE_DECLTYPES, isolation_level=None)
db.row_factory = sqlite3.Row
bot.cursor = db.cursor()
bot.cursor.execute("CREATE TABLE IF NOT EXISTS users(id integer PRIMARY KEY NOT NULL,prefix pickle,gpoint integer,memo json,levcard text,onnotif pickle,lang text,accounts pickle,sinapartner integer,gban integer,gnick text,gcolor integer,gmod integer,gstar integer,galpha integer,gbanhist text)")
bot.cursor.execute("CREATE TABLE IF NOT EXISTS guilds(id integer PRIMARY KEY NOT NULL,levels json,commands json,hash pickle,levelupsendto integer,reward json,jltasks json,lockcom pickle,sendlog integer,prefix pickle,lang text)")
bot.cursor.execute("CREATE TABLE IF NOT EXISTS globalchs(name text PRIMARY KEY NOT NULL,ids pickle)")
bot.cursor.execute("CREATE TABLE IF NOT EXISTS globaldates(id integer PRIMARY KEY NOT NULL,content text,allid pickle,aid integer,gid integer,timestamp text)")
bot.cursor.execute("CREATE TABLE IF NOT EXISTS invites(id text PRIMARY KEY NOT NULL, guild_id int NOT NULL, uses integer, inviter_id integer NOT NULL);")
bot.cursor.execute("CREATE TABLE IF NOT EXISTS gban_settings(id integer PRIMARY KEY NOT NULL,chid integer);")
bot.cursor.execute("CREATE TABLE IF NOT EXISTS gban_dates(id integer PRIMARY KEY NOT NULL,reason text NOT NULL,gban_by id NOT NULL);")

bot.cursor.execute("CREATE TABLE IF NOT EXISTS welcome_auth(id integer PRIMARY KEY NOT NULL,category integer,use integer NOT NULL,can_view pickle NOT NULL,next_reaction NOT NULL,au_w pickle NOT NULL,give_role integer NOT NULL);")
try:
    bot.cursor.execute("ALTER TABLE users ADD COLUMN online_agreed integer;")
except:
    pass
bot.session = aiohttp.ClientSession(loop=bot.loop)

bot._default_close = bot.close
async def close_handler():
    await bot._default_close()
    await bot.session.close()
    try:
        db.commit()
    except sqlite3.ProgrammingError:
        pass
    else:
        db.close()
bot.close = close_handler

bot.translate_handler = TranslateHandler(bot, ["en", "ja"])
bot._get_context = bot.get_context
async def get_context(msg, cls=LocalizedContext):
    ctx = await bot._get_context(msg, cls=cls)
    ctx.context_at = datetime.datetime.utcnow().timestamp()
    return ctx
bot.get_context = get_context

bot._ = bot.translate_handler.get_translation_for
bot.l10n_guild = bot.translate_handler.get_guild_translation_for
bot.l10n_any = bot.translate_handler.get_any_translation
bot.l10n_raw = bot.translate_handler.get_raw_translation

"""
au_w:[
        {
            "reactions":["str" or "id"(0-19)],
            "give_role"[None or id(int)],
            "text":str""
        },...
    ]
"""


DoServercmd = False
gprofilever = "v1.0.1"
wikipedia.set_lang('ja')
bot.mwc = wikidata.client.Client()
rpcct = 0
rpcs =[
    "ãƒ˜ãƒ«ãƒ—:s-help",
    "ã‚¢ã‚¤ã‚³ãƒ³:ãŠã‚ãšã•ã‚“",
    "ã‚µãƒ¼ãƒãƒ¼æ•°:{0}",
    "ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°:{1}",
    "ä½œæˆ:ãƒãƒ¼ãƒ â˜†æ€æƒŸå¥ˆã¡ã‚ƒã‚“",
    "åˆ¶ä½œãƒªãƒ¼ãƒ€ãƒ¼:mii-10#3110",
    "help:s-help",
    "icon:oaz_n",
    "{0}guilds",
    "{1}users",
    "created by mii-10#3110"
]
"""db = dropbox.Dropbox(DROP_TOKEN)
db.users_get_current_account()"""
bot.twi = Twitter(auth=OAuth(bot.T_Acs_Token,bot.T_Acs_SToken,bot.T_API_key,bot.T_API_SKey))
bot.ec = 0x42bcf4
Donotif = False
bot.StartTime = datetime.datetime.now()

aglch=None

bot.partnerg=config.pg

bot.features=config.sp_features

bot.apple_util = AppleUtil(bot)

def shares_guild(user_id_a, user_id_b):
    return not not [
        guild
        for guild
        in bot.guilds
        if set([user_id_a, user_id_b]).issubset(frozenset(guild._members.keys()))
    ]
bot.shares_guild = shares_guild

def can_use_online(self, user):
    enabled = bot.cursor.execute("SELECT online_agreed FROM users WHERE id = ?", (user.id,)).fetchone()
    return enabled and enabled["online_agreed"]
bot.can_use_online = can_use_online

#åˆå›ãƒ­ãƒ¼ãƒ‰
"""db.files_download_to_file( "guildsetting.json" , "/guildsetting.json" )
db.files_download_to_file( "profiles.json" , "/profiles.json" )
db.files_download_to_file( "gp.json" , "/gp.json" )
db.files_download_to_file( "globaldatas.json" , "/globaldatas.json" )
db.files_download_to_file( "gchatchs.json" , "/gchatchs.json" )"""

bot.tl="ã€€ã‚” ã€ã€‚ï¼Œï¼ãƒ»ï¼šï¼›ï¼Ÿï¼ã‚›ã‚œÂ´ï½€Â¨ï¼¾ï¿£ï¼¿ãƒ½ãƒ¾ã‚ã‚ã€ƒä»ã€…ã€†ã€‡ãƒ¼â€•â€ï¼ï¼¼ï½âˆ¥ï½œâ€¦â€¥â€˜â€™â€œâ€ï¼ˆï¼‰ã€”ã€•ï¼»ï¼½ï½›ï½ã€ˆã€‰ã€Šã€‹ã€Œã€ã€ã€ã€ã€‘ï¼‹ï¼Â±Ã—Ã·ï¼â‰ ï¼œï¼â‰¦â‰§âˆâˆ´â™‚â™€Â°â€²â€³â„ƒï¿¥ï¼„ï¿ ï¿¡ï¼…ï¼ƒï¼†ï¼Šï¼ Â§â˜†â˜…â—‹â—â—â—‡â—†â–¡â– â–³â–²â–½â–¼â€»ã€’â†’â†â†‘â†“ã€“âˆˆâˆ‹âŠ†âŠ‡âŠ‚âŠƒâˆªâˆ©âˆ§âˆ¨ï¿¢â‡’â‡”âˆ€âˆƒâˆ âŠ¥âŒ’âˆ‚âˆ‡â‰¡â‰’â‰ªâ‰«âˆšâˆ½âˆâˆµâˆ«âˆ¬â„«â€°â™¯â™­â™ªâ€ â€¡Â¶â—¯ï¼ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™1234567890ï½ï½‚ï½ƒï½„ï½…ï½†ï½‡ï½ˆï½‰ï½Šï½‹ï½Œï½ï½ï½ï½ï½‘ï½’ï½“ï½”ï½•ï½–ï½—ï½˜ï½™ï½šabcdefghijklmnopqrstuvwxyz-^\=~|@[]:;\/.,<>?_+*}{`!\"#$%&'()ãã‚ãƒã„ã…ã†ã‡ãˆã‰ãŠã‹ãŒããããã‘ã’ã“ã”ã•ã–ã—ã˜ã™ãšã›ãœãããŸã ã¡ã¢ã£ã¤ã¥ã¦ã§ã¨ã©ãªã«ã¬ã­ã®ã¯ã°ã±ã²ã³ã´ãµã¶ã·ã¸ã¹ãºã»ã¼ã½ã¾ã¿ã‚€ã‚ã‚‚ã‚ƒã‚„ã‚…ã‚†ã‚‡ã‚ˆã‚‰ã‚Šã‚‹ã‚Œã‚ã‚ã‚ã‚ã‚‘ã‚’ã‚“ã‚¡ã‚¢ã‚£ã‚¤ã‚¥ã‚¦ã‚§ã‚¨ã‚©ã‚ªã‚«ã‚¬ã‚­ã‚®ã‚¯ã‚°ã‚±ã‚²ã‚³ã‚´ã‚µã‚¶ã‚·ã‚¸ã‚¹ã‚ºã‚»ã‚¼ã‚½ã‚¾ã‚¿ãƒ€ãƒãƒ‚ãƒƒãƒ„ãƒ…ãƒ†ãƒ‡ãƒˆãƒ‰ãƒŠãƒ‹ãƒŒãƒãƒãƒãƒãƒ‘ãƒ’ãƒ“ãƒ”ãƒ•ãƒ–ãƒ—ãƒ˜ãƒ™ãƒšãƒ›ãƒœãƒãƒãƒŸãƒ ãƒ¡ãƒ¢ãƒ£ãƒ¤ãƒ¥ãƒ¦ãƒ§ãƒ¨ãƒ©ãƒªãƒ«ãƒ¬ãƒ­ãƒ®ãƒ¯ãƒ°ãƒ±ãƒ²ãƒ³ãƒ´ãƒµãƒ¶Î‘Î’Î“Î”Î•Î–Î—Î˜Î™ÎšÎ›ÎœÎÎÎŸÎ Î¡Î£Î¤Î¥Î¦Î§Î¨Î©Î±Î²Î³Î´ÎµÎ¶Î·Î¸Î¹ÎºÎ»Î¼Î½Î¾Î¿Ï€ÏÏƒÏ„Ï…Ï†Ï‡ÏˆÏ‰ĞĞ‘Ğ’Ğ“Ğ”Ğ•ĞĞ–Ğ—Ğ˜Ğ™ĞšĞ›ĞœĞĞĞŸĞ Ğ¡Ğ¢Ğ£Ğ¤Ğ¥Ğ¦Ğ§Ğ¨Ğ©ĞªĞ«Ğ¬Ğ­Ğ®Ğ¯Ğ°Ğ±Ğ²Ğ³Ğ´ĞµÑ‘Ğ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑâ”€â”‚â”Œâ”â”˜â””â”œâ”¬â”¤â”´â”¼â”â”ƒâ”â”“â”›â”—â”£â”³â”«â”»â•‹â” â”¯â”¨â”·â”¿â”â”°â”¥â”¸â•‚äºœå”–å¨ƒé˜¿å“€æ„›æŒ¨å§¶é€¢è‘µèŒœç©æ‚ªæ¡æ¸¥æ—­è‘¦èŠ¦é¯µæ¢“åœ§æ–¡æ‰±å®›å§è™»é£´çµ¢ç¶¾é®æˆ–ç²Ÿè¢·å®‰åºµæŒ‰æš—æ¡ˆé—‡éæä»¥ä¼Šä½ä¾å‰å›²å¤·å§”å¨å°‰æƒŸæ„æ…°æ˜“æ¤…ç‚ºç•ç•°ç§»ç¶­ç·¯èƒƒèè¡£è¬‚é•éºåŒ»äº•äº¥åŸŸè‚²éƒç£¯ä¸€å£±æº¢é€¸ç¨²èŒ¨èŠ‹é°¯å…å°å’½å“¡å› å§»å¼•é£²æ·«èƒ¤è”­é™¢é™°éš éŸ»å‹å³å®‡çƒç¾½è¿‚é›¨å¯éµœçªºä¸‘ç¢“è‡¼æ¸¦å˜˜å”„æ¬è”šé°»å§¥å©æµ¦ç“œé–å™‚äº‘é‹é›²èé¤Œå¡å–¶å¬°å½±æ˜ æ›³æ „æ°¸æ³³æ´©ç‘›ç›ˆç©é ´è‹±è¡›è© é‹­æ¶²ç–«ç›Šé§…æ‚¦è¬è¶Šé–²æ¦å­å††åœ’å °å¥„å®´å»¶æ€¨æ©æ´æ²¿æ¼”ç‚ç„”ç…™ç‡•çŒ¿ç¸è‰¶è‹‘è–—é é‰›é´›å¡©æ–¼æ±šç”¥å‡¹å¤®å¥¥å¾€å¿œæŠ¼æ—ºæ¨ªæ¬§æ®´ç‹ç¿è¥–é´¬é´é»„å²¡æ²–è»å„„å±‹æ†¶è‡†æ¡¶ç‰¡ä¹™ä¿ºå¸æ©æ¸©ç©éŸ³ä¸‹åŒ–ä»®ä½•ä¼½ä¾¡ä½³åŠ å¯å˜‰å¤å«å®¶å¯¡ç§‘æš‡æœæ¶æ­Œæ²³ç«ç‚ç¦ç¦¾ç¨¼ç®‡èŠ±è‹›èŒ„è·è¯è“è¦èª²å˜©è²¨è¿¦ééœèšŠä¿„å³¨æˆ‘ç‰™ç”»è‡¥èŠ½è›¾è³€é›…é¤“é§•ä»‹ä¼šè§£å›å¡Šå£Šå»»å¿«æ€ªæ‚”æ¢æ‡æˆ’æ‹æ”¹é­æ™¦æ¢°æµ·ç°ç•Œçš†çµµèŠ¥èŸ¹é–‹éšè²å‡±åŠ¾å¤–å’³å®³å´–æ…¨æ¦‚æ¶¯ç¢è“‹è¡—è©²é§éª¸æµ¬é¦¨è›™å£æŸ¿è›éˆåŠƒåš‡å„å»“æ‹¡æ’¹æ ¼æ ¸æ®»ç²ç¢ºç©«è¦šè§’èµ«è¼ƒéƒ­é–£éš”é©å­¦å²³æ¥½é¡é¡æ›ç¬ æ¨«æ©¿æ¢¶é°æ½Ÿå‰²å–æ°æ‹¬æ´»æ¸‡æ»‘è‘›è¤è½„ä¸”é°¹å¶æ¤›æ¨ºé„æ ªå…œç«ƒè’²é‡œéŒå™›é´¨æ ¢èŒ…è±ç²¥åˆˆè‹…ç“¦ä¹¾ä¾ƒå† å¯’åˆŠå‹˜å‹§å·»å–šå ªå§¦å®Œå®˜å¯›å¹²å¹¹æ‚£æ„Ÿæ…£æ†¾æ›æ•¢æŸ‘æ¡“æ£ºæ¬¾æ­“æ±—æ¼¢æ¾—æ½…ç’°ç”˜ç›£çœ‹ç«¿ç®¡ç°¡ç·©ç¼¶ç¿°è‚è‰¦èè¦³è«Œè²«é‚„é‘‘é–“é–‘é–¢é™¥éŸ“é¤¨èˆ˜ä¸¸å«å²¸å·Œç©ç™Œçœ¼å²©ç¿«è´‹é›é ‘é¡”é¡˜ä¼ä¼å±å–œå™¨åŸºå¥‡å¬‰å¯„å²å¸Œå¹¾å¿Œæ®æœºæ——æ—¢æœŸæ£‹æ£„æ©Ÿå¸°æ¯…æ°—æ±½ç•¿ç¥ˆå­£ç¨€ç´€å¾½è¦è¨˜è²´èµ·è»Œè¼é£¢é¨é¬¼äº€å½å„€å¦“å®œæˆ¯æŠ€æ“¬æ¬ºçŠ ç–‘ç¥‡ç¾©èŸ»èª¼è­°æ¬èŠé å‰åƒå–«æ¡”æ©˜è©°ç §æµé»å´å®¢è„šè™é€†ä¸˜ä¹…ä»‡ä¼‘åŠå¸å®®å¼“æ€¥æ•‘æœ½æ±‚æ±²æ³£ç¸çƒç©¶çª®ç¬ˆç´šç³¾çµ¦æ—§ç‰›å»å±…å·¨æ‹’æ‹ æŒ™æ¸ è™šè¨±è·é‹¸æ¼ç¦¦é­šäº¨äº«äº¬ä¾›ä¾ åƒ‘å…‡ç«¶å…±å‡¶å”åŒ¡å¿å«å–¬å¢ƒå³¡å¼·å½Šæ€¯ææ­æŒŸæ•™æ©‹æ³ç‹‚ç‹­çŸ¯èƒ¸è„…èˆˆè•éƒ·é¡éŸ¿é¥—é©šä»°å‡å°­æšæ¥­å±€æ›²æ¥µç‰æ¡ç²åƒ…å‹¤å‡å·¾éŒ¦æ–¤æ¬£æ¬½ç´ç¦ç¦½ç­‹ç·ŠèŠ¹èŒè¡¿è¥Ÿè¬¹è¿‘é‡‘åŸéŠ€ä¹å€¶å¥åŒºç‹—ç–çŸ©è‹¦èº¯é§†é§ˆé§’å…·æ„šè™å–°ç©ºå¶å¯“é‡éš…ä¸²æ«›é‡§å±‘å±ˆæ˜çªŸæ²“é´è½¡çªªç†Šéšˆç²‚æ —ç¹°æ¡‘é¬å‹²å›è–«è¨“ç¾¤è»éƒ¡å¦è¢ˆç¥ä¿‚å‚¾åˆ‘å…„å•“åœ­çªå‹å¥‘å½¢å¾„æµæ…¶æ…§æ†©æ²æºæ•¬æ™¯æ¡‚æ¸“ç•¦ç¨½ç³»çµŒç¶™ç¹‹ç½«èŒèŠè›è¨ˆè©£è­¦è»½é šé¶èŠ¸è¿é¯¨åŠ‡æˆŸæ’ƒæ¿€éš™æ¡å‚‘æ¬ æ±ºæ½”ç©´çµè¡€è¨£æœˆä»¶å€¹å€¦å¥å…¼åˆ¸å‰£å–§åœå …å«Œå»ºæ†²æ‡¸æ‹³æ²æ¤œæ¨©ç‰½çŠ¬çŒ®ç ”ç¡¯çµ¹çœŒè‚©è¦‹è¬™è³¢è»’é£éµé™ºé¡•é¨“é¹¸å…ƒåŸå³å¹»å¼¦æ¸›æºç„ç¾çµƒèˆ·è¨€è«ºé™ä¹å€‹å¤å‘¼å›ºå§‘å­¤å·±åº«å¼§æˆ¸æ•…æ¯æ¹–ç‹ç³Šè¢´è‚¡èƒ¡è°è™èª‡è·¨éˆ·é›‡é¡§é¼“äº”äº’ä¼åˆå‘‰å¾å¨¯å¾Œå¾¡æ‚Ÿæ¢§æªç‘šç¢èªèª¤è­·é†ä¹é¯‰äº¤ä½¼ä¾¯å€™å€–å…‰å…¬åŠŸåŠ¹å‹¾åšå£å‘åå–‰å‘å¢å¥½å­”å­å®å·¥å·§å··å¹¸åºƒåºšåº·å¼˜æ’æ…ŒæŠ—æ‹˜æ§æ”»æ˜‚æ™ƒæ›´æ­æ ¡æ¢—æ§‹æ±Ÿæ´ªæµ©æ¸¯æºç”²çš‡ç¡¬ç¨¿ç³ ç´…ç´˜çµç¶±è€•è€ƒè‚¯è‚±è…”è†èˆªè’è¡Œè¡¡è¬›è²¢è³¼éƒŠé…µé‰±ç ¿é‹¼é–¤é™é …é¦™é«˜é´»å‰›åŠ«å·åˆå£•æ‹·æ¿ è±ªè½Ÿéº¹å…‹åˆ»å‘Šå›½ç©€é…·éµ é»’ç„æ¼‰è…°ç”‘å¿½æƒšéª¨ç‹›è¾¼æ­¤é ƒä»Šå›°å¤å¢¾å©šæ¨æ‡‡æ˜æ˜†æ ¹æ¢±æ··ç—•ç´ºè‰®é­‚äº›ä½å‰å”†åµ¯å·¦å·®æŸ»æ²™ç‘³ç ‚è©é–è£Ÿååº§æŒ«å‚µå‚¬å†æœ€å“‰å¡å¦»å®°å½©æ‰æ¡æ ½æ­³æ¸ˆç½é‡‡çŠ€ç •ç ¦ç¥­æ–ç´°èœè£è¼‰éš›å‰¤åœ¨æç½ªè²¡å†´å‚é˜ªå ºæ¦Šè‚´å’²å´åŸ¼ç¢•é·ºä½œå‰Šå’‹æ¾æ˜¨æœ”æŸµçª„ç­–ç´¢éŒ¯æ¡œé®­ç¬¹åŒ™å†Šåˆ·å¯Ÿæ‹¶æ’®æ“¦æœ­æ®ºè–©é›‘çšé¯–æŒéŒ†é®«çš¿æ™’ä¸‰å‚˜å‚å±±æƒ¨æ’’æ•£æ¡Ÿç‡¦çŠç”£ç®—çº‚èš•è®ƒè³›é…¸é¤æ–¬æš«æ®‹ä»•ä»”ä¼ºä½¿åˆºå¸å²å—£å››å£«å§‹å§‰å§¿å­å±å¸‚å¸«å¿—æ€æŒ‡æ”¯å­œæ–¯æ–½æ—¨ææ­¢æ­»æ°ç…ç¥‰ç§ç³¸ç´™ç´«è‚¢è„‚è‡³è¦–è©è©©è©¦èªŒè«®è³‡è³œé›Œé£¼æ­¯äº‹ä¼¼ä¾å…å­—å¯ºæ…ˆæŒæ™‚æ¬¡æ»‹æ²»çˆ¾ç’½ç—”ç£ç¤ºè€Œè€³è‡ªè’”è¾æ±é¹¿å¼è­˜é´«ç«ºè»¸å®é›«ä¸ƒå±åŸ·å¤±å«‰å®¤æ‚‰æ¹¿æ¼†ç–¾è³ªå®Ÿè”€ç¯ å²æŸ´èŠå±¡è•Šç¸èˆå†™å°„æ¨èµ¦æ–œç…®ç¤¾ç´—è€…è¬è»Šé®è›‡é‚ªå€Ÿå‹ºå°ºæ“ç¼çˆµé…Œé‡ˆéŒ«è‹¥å¯‚å¼±æƒ¹ä¸»å–å®ˆæ‰‹æœ±æ®Šç‹©ç ç¨®è…«è¶£é…’é¦–å„’å—å‘ªå¯¿æˆæ¨¹ç¶¬éœ€å›šåå‘¨å®—å°±å·ä¿®æ„æ‹¾æ´²ç§€ç§‹çµ‚ç¹ç¿’è‡­èˆŸè’è¡†è¥²è®è¹´è¼¯é€±é…‹é…¬é›†é†œä»€ä½å……åå¾“æˆæŸ”æ±æ¸‹ç£ç¸¦é‡éŠƒå”å¤™å®¿æ·‘ç¥ç¸®ç²›å¡¾ç†Ÿå‡ºè¡“è¿°ä¿Šå³»æ˜¥ç¬ç«£èˆœé§¿å‡†å¾ªæ—¬æ¥¯æ®‰æ·³æº–æ½¤ç›¾ç´”å·¡éµé†‡é †å‡¦åˆæ‰€æš‘æ›™æ¸šåº¶ç·’ç½²æ›¸è–¯è—·è«¸åŠ©å™å¥³åºå¾æ•é‹¤é™¤å‚·å„Ÿå‹åŒ å‡å¬å“¨å•†å”±å˜—å¥¨å¦¾å¨¼å®µå°†å°å°‘å°šåº„åºŠå» å½°æ‰¿æŠ„æ‹›æŒæ·æ˜‡æ˜Œæ˜­æ™¶æ¾æ¢¢æ¨Ÿæ¨µæ²¼æ¶ˆæ¸‰æ¹˜ç„¼ç„¦ç…§ç—‡çœç¡ç¤ç¥¥ç§°ç« ç¬‘ç²§ç´¹è‚–è–è’‹è•‰è¡è£³è¨Ÿè¨¼è©”è©³è±¡è³é†¤é‰¦é¾é˜éšœé˜ä¸Šä¸ˆä¸ä¹—å†—å‰°åŸå ´å£Œå¬¢å¸¸æƒ…æ“¾æ¡æ–æµ„çŠ¶ç•³ç©£è’¸è­²é†¸éŒ å˜±åŸ´é£¾æ‹­æ¤æ®–ç‡­ç¹”è·è‰²è§¦é£Ÿè•è¾±å°»ä¼¸ä¿¡ä¾µå”‡å¨ å¯å¯©å¿ƒæ…æŒ¯æ–°æ™‹æ£®æ¦›æµ¸æ·±ç”³ç–¹çœŸç¥ç§¦ç´³è‡£èŠ¯è–ªè¦ªè¨ºèº«è¾›é€²é‡éœ‡äººä»åˆƒå¡µå£¬å°‹ç”šå°½è…è¨Šè¿…é™£é­ç¬¥è«é ˆé…¢å›³å¨é€—å¹å‚å¸¥æ¨æ°´ç‚Šç¡ç²‹ç¿ è¡°é‚é…”éŒéŒ˜éšç‘é«„å´‡åµ©æ•°æ¢è¶¨é››æ®æ‰æ¤™è…é —é›€è£¾æ¾„æ‘ºå¯¸ä¸–ç€¬ç•æ˜¯å‡„åˆ¶å‹¢å§“å¾æ€§æˆæ”¿æ•´æ˜Ÿæ™´æ£²æ –æ­£æ¸…ç‰²ç”Ÿç››ç²¾è–å£°è£½è¥¿èª èª“è«‹é€é†’é’é™æ–‰ç¨è„†éš»å¸­æƒœæˆšæ–¥æ˜”æçŸ³ç©ç±ç¸¾è„Šè²¬èµ¤è·¡è¹Ÿç¢©åˆ‡æ‹™æ¥æ‘‚æŠ˜è¨­çªƒç¯€èª¬é›ªçµ¶èˆŒè‰ä»™å…ˆåƒå å®£å°‚å°–å·æˆ¦æ‰‡æ’°æ “æ ´æ³‰æµ…æ´—æŸ“æ½œç…ç…½æ—‹ç©¿ç®­ç·šç¹Šç¾¨è…ºèˆ›èˆ¹è–¦è©®è³è·µé¸é·éŠ­éŠ‘é–ƒé®®å‰å–„æ¼¸ç„¶å…¨ç¦…ç¹•è†³ç³å™Œå¡‘å²¨æªæ›¾æ›½æ¥šç‹™ç–ç–ç¤ç¥–ç§Ÿç²—ç´ çµ„è˜‡è¨´é˜»é¡é¼ åƒ§å‰µåŒå¢å€‰å–ªå£®å¥çˆ½å®‹å±¤åŒæƒ£æƒ³æœæƒæŒ¿æ»æ“æ—©æ›¹å·£æ§æ§½æ¼•ç‡¥äº‰ç—©ç›¸çª“ç³Ÿç·ç¶œè¡è‰è˜è‘¬è’¼è—»è£…èµ°é€é­é—éœœé¨’åƒå¢—æ†è‡“è”µè´ˆé€ ä¿ƒå´å‰‡å³æ¯æ‰æŸæ¸¬è¶³é€Ÿä¿—å±è³Šæ—ç¶šå’è¢–å…¶æƒå­˜å­«å°Šææ‘éœä»–å¤šå¤ªæ±°è©‘å”¾å •å¦¥æƒ°æ‰“æŸèˆµæ¥•é™€é§„é¨¨ä½“å †å¯¾è€å²±å¸¯å¾…æ€ æ…‹æˆ´æ›¿æ³°æ»èƒè…¿è‹”è¢‹è²¸é€€é€®éšŠé»›é¯›ä»£å°å¤§ç¬¬é†é¡Œé·¹æ»ç€§å“å•„å®…æ‰˜æŠæ‹“æ²¢æ¿¯ç¢è¨—é¸æ¿è«¾èŒ¸å‡§è›¸åªå©ä½†é”è¾°å¥ªè„±å·½ç«ªè¾¿æ£šè°·ç‹¸é±ˆæ¨½èª°ä¸¹å˜å˜†å¦æ‹…æ¢æ—¦æ­æ·¡æ¹›ç‚­çŸ­ç«¯ç®ªç¶»è€½èƒ†è›‹èª•é›å›£å£‡å¼¾æ–­æš–æª€æ®µç”·è«‡å€¤çŸ¥åœ°å¼›æ¥æ™ºæ± ç—´ç¨šç½®è‡´èœ˜é…é¦³ç¯‰ç•œç«¹ç­‘è“„é€ç§©çª’èŒ¶å«¡ç€ä¸­ä»²å®™å¿ æŠ½æ˜¼æŸ±æ³¨è™«è¡·è¨»é…é‹³é§æ¨—ç€¦çŒªè‹§è‘—è²¯ä¸å…†å‡‹å–‹å¯µå¸–å¸³åºå¼”å¼µå½«å¾´æ‡²æŒ‘æš¢æœæ½®ç‰’ç”ºçœºè´è„¹è…¸è¶èª¿è«œè¶…è·³éŠšé•·é ‚é³¥å‹…æ—ç›´æœ•æ²ˆçè³ƒé®é™³æ´¥å¢œæ¤æ§Œè¿½éšç—›é€šå¡šæ ‚æ´æ§»ä½ƒæ¼¬æŸ˜è¾»è”¦ç¶´é”æ¤¿æ½°åªå£·å¬¬ç´¬çˆªåŠé‡£é¶´äº­ä½åœåµå‰ƒè²å‘ˆå ¤å®šå¸åº•åº­å»·å¼Ÿæ‚ŒæŠµæŒºææ¢¯æ±€ç¢‡ç¦ç¨‹ç· è‰‡è¨‚è«¦è¹„é€“é‚¸é„­é‡˜é¼æ³¥æ‘˜æ“¢æ•µæ»´çš„ç¬›é©é‘æººå“²å¾¹æ’¤è½è¿­é‰„å…¸å¡«å¤©å±•åº—æ·»çºç”œè²¼è»¢é¡›ç‚¹ä¼æ®¿æ¾±ç”°é›»å…åå µå¡—å¦¬å± å¾’æ–—æœæ¸¡ç™»èŸè³­é€”éƒ½éç ¥ç ºåŠªåº¦åœŸå¥´æ€’å€’å…šå†¬å‡åˆ€å”å¡”å¡˜å¥—å®•å³¶å¶‹æ‚¼æŠ•æ­æ±æ¡ƒæ¢¼æ£Ÿç›—æ·˜æ¹¯æ¶›ç¯ç‡ˆå½“ç—˜ç¥·ç­‰ç­”ç­’ç³–çµ±åˆ°è‘£è•©è—¤è¨è¬„è±†è¸é€ƒé€é™é™¶é ­é¨°é—˜åƒå‹•åŒå ‚å°æ†§æ’æ´ç³ç«¥èƒ´è„é“éŠ…å³ é´‡åŒ¿å¾—å¾³æ¶œç‰¹ç£ç¦¿ç¯¤æ¯’ç‹¬èª­æ ƒæ©¡å‡¸çªæ¤´å±Šé³¶è‹«å¯…é…‰ç€å™¸å±¯æƒ‡æ•¦æ²Œè±šéé “å‘‘æ›‡éˆå¥ˆé‚£å†…ä¹å‡ªè–™è¬ç˜æºé‹æ¥¢é¦´ç¸„ç•·å—æ¥ è»Ÿé›£æ±äºŒå°¼å¼è¿©åŒ‚è³‘è‚‰è™¹å»¿æ—¥ä¹³å…¥å¦‚å°¿éŸ®ä»»å¦Šå¿èªæ¿¡ç¦°ç¥¢å¯§è‘±çŒ«ç†±å¹´å¿µæ»æ’šç‡ƒç²˜ä¹ƒå»¼ä¹‹åŸœåš¢æ‚©æ¿ƒç´èƒ½è„³è†¿è¾²è¦—èš¤å·´æŠŠæ’­è¦‡æ·æ³¢æ´¾ç¶ç ´å©†ç½µèŠ­é¦¬ä¿³å»ƒæ‹æ’æ•—æ¯ç›ƒç‰ŒèƒŒè‚ºè¼©é…å€åŸ¹åª’æ¢…æ¥³ç…¤ç‹½è²·å£²è³ é™ªé€™è¿ç§¤çŸ§è©ä¼¯å‰¥åšæ‹æŸæ³Šç™½ç®”ç²•èˆ¶è–„è¿«æ›æ¼ çˆ†ç¸›è«é§éº¦å‡½ç®±ç¡²ç®¸è‚‡ç­ˆæ«¨å¹¡è‚Œç•‘ç• å…«é‰¢æºŒç™ºé†—é«ªä¼ç½°æŠœç­é–¥é³©å™ºå¡™è›¤éš¼ä¼´åˆ¤åŠåå›å¸†æ¬æ–‘æ¿æ°¾æ±ç‰ˆçŠ¯ç­ç•”ç¹èˆ¬è—©è²©ç¯„é‡†ç…©é ’é£¯æŒ½æ™©ç•ªç›¤ç£è•ƒè›®åŒªå‘å¦å¦ƒåº‡å½¼æ‚²æ‰‰æ‰¹æŠ«æ–æ¯”æ³Œç–²çš®ç¢‘ç§˜ç·‹ç½·è‚¥è¢«èª¹è²»é¿éé£›æ¨‹ç°¸å‚™å°¾å¾®æ‡æ¯˜çµçœ‰ç¾é¼»æŸŠç¨—åŒ¹ç–‹é«­å½¦è†è±è‚˜å¼¼å¿…ç•¢ç­†é€¼æ¡§å§«åª›ç´ç™¾è¬¬ä¿µå½ªæ¨™æ°·æ¼‚ç“¢ç¥¨è¡¨è©•è±¹å»Ÿæç—…ç§’è‹—éŒ¨é‹²è’œè›­é°­å“å½¬æ–Œæµœç€•è²§è³“é »æ•ç“¶ä¸ä»˜åŸ å¤«å©¦å¯Œå†¨å¸ƒåºœæ€–æ‰¶æ•·æ–§æ™®æµ®çˆ¶ç¬¦è…è†šèŠ™è­œè² è³¦èµ´é˜œé™„ä¾®æ’«æ­¦èˆè‘¡è•ªéƒ¨å°æ¥“é¢¨è‘ºè•—ä¼å‰¯å¾©å¹…æœç¦è…¹è¤‡è¦†æ·µå¼—æ‰•æ²¸ä»ç‰©é®’åˆ†å»å™´å¢³æ†¤æ‰®ç„šå¥®ç²‰ç³ç´›é›°æ–‡èä¸™ä½µå…µå¡€å¹£å¹³å¼ŠæŸ„ä¸¦è”½é–‰é™›ç±³é åƒ»å£ç™–ç¢§åˆ¥ç¥è”‘ç®†åå¤‰ç‰‡ç¯‡ç·¨è¾ºè¿”éä¾¿å‹‰å¨©å¼é­ä¿èˆ—é‹ªåœƒæ•æ­©ç”«è£œè¼”ç©‚å‹Ÿå¢“æ…•æˆŠæš®æ¯ç°¿è©å€£ä¿¸åŒ…å‘†å ±å¥‰å®å³°å³¯å´©åº–æŠ±æ§æ”¾æ–¹æœ‹æ³•æ³¡çƒ¹ç ²ç¸«èƒèŠ³èŒè“¬èœ‚è¤’è¨ªè±Šé‚¦é‹’é£½é³³éµ¬ä¹äº¡å‚å‰–åŠå¦¨å¸½å¿˜å¿™æˆ¿æš´æœ›æŸæ£’å†’ç´¡è‚ªè†¨è¬€è²Œè²¿é‰¾é˜²å é ¬åŒ—åƒ•åœå¢¨æ’²æœ´ç‰§ç¦ç©†é‡¦å‹ƒæ²¡æ®†å €å¹Œå¥”æœ¬ç¿»å‡¡ç›†æ‘©ç£¨é­”éº»åŸ‹å¦¹æ˜§æšæ¯å“©æ§™å¹•è†œæ•é®ªæŸ¾é±’æ¡äº¦ä¿£åˆæŠ¹æœ«æ²«è¿„ä¾­ç¹­éº¿ä¸‡æ…¢æº€æ¼«è”“å‘³æœªé­…å·³ç®•å²¬å¯†èœœæ¹Šè“‘ç¨”è„ˆå¦™ç²æ°‘çœ å‹™å¤¢ç„¡ç‰ŸçŸ›éœ§éµ¡æ¤‹å©¿å¨˜å†¥åå‘½æ˜ç›Ÿè¿·éŠ˜é³´å§ªç‰æ»…å…æ£‰ç¶¿ç·¬é¢éººæ‘¸æ¨¡èŒ‚å¦„å­Ÿæ¯›çŒ›ç›²ç¶²è€—è’™å„²æœ¨é»™ç›®æ¢å‹¿é¤…å°¤æˆ»ç±¾è²°å•æ‚¶ç´‹é–€åŒä¹Ÿå†¶å¤œçˆºè€¶é‡å¼¥çŸ¢å„å½¹ç´„è–¬è¨³èºé–æŸ³è–®é‘“æ„‰æ„ˆæ²¹ç™’è«­è¼¸å”¯ä½‘å„ªå‹‡å‹å®¥å¹½æ‚ æ†‚æ–æœ‰æŸšæ¹§æ¶ŒçŒ¶çŒ·ç”±ç¥è£•èª˜éŠé‚‘éƒµé›„èå¤•äºˆä½™ä¸èª‰è¼¿é å‚­å¹¼å¦–å®¹åº¸æšæºæ“æ›œæ¥Šæ§˜æ´‹æº¶ç†”ç”¨çª¯ç¾Šè€€è‘‰è“‰è¦è¬¡è¸Šé¥é™½é¤Šæ…¾æŠ‘æ¬²æ²ƒæµ´ç¿Œç¿¼æ·€ç¾…èºè£¸æ¥è±é ¼é›·æ´›çµ¡è½é…ªä¹±åµåµæ¬„æ¿«è—è˜­è¦§åˆ©åå±¥ææ¢¨ç†ç’ƒç—¢è£è£¡é‡Œé›¢é™¸å¾‹ç‡ç«‹è‘æ ç•¥åŠ‰æµæºœç‰ç•™ç¡«ç²’éš†ç«œé¾ä¾¶æ…®æ—…è™œäº†äº®åƒšä¸¡å‡Œå¯®æ–™æ¢æ¶¼çŒŸç™‚ç­ç¨œç³§è‰¯è«’é¼é‡é™µé ˜åŠ›ç·‘å€«å˜æ—æ·‹ç‡ç³è‡¨è¼ªéš£é±—éºŸç‘ å¡æ¶™ç´¯é¡ä»¤ä¼¶ä¾‹å†·åŠ±å¶ºæ€œç²ç¤¼è‹“éˆ´éš·é›¶éœŠéº—é½¢æš¦æ­´åˆ—åŠ£çƒˆè£‚å»‰æ‹æ†æ¼£ç…‰ç°¾ç·´è¯è“®é€£éŒ¬å‘‚é­¯æ«“ç‚‰è³‚è·¯éœ²åŠ´å©å»Šå¼„æœ—æ¥¼æ¦”æµªæ¼ç‰¢ç‹¼ç¯­è€è¾è‹éƒå…­éº“ç¦„è‚‹éŒ²è«–å€­å’Œè©±æ­ªè³„è„‡æƒ‘æ é·²äº™äº˜é°è©«è—è•¨æ¤€æ¹¾ç¢—è…•å¼Œä¸ä¸•ä¸ªä¸±ä¸¶ä¸¼ä¸¿ä¹‚ä¹–ä¹˜äº‚äº…è±«äºŠèˆ’å¼äºäºäºŸäº äº¢äº°äº³äº¶ä»ä»ä»„ä»†ä»‚ä»—ä»ä»­ä»Ÿä»·ä¼‰ä½šä¼°ä½›ä½ä½—ä½‡ä½¶ä¾ˆä¾ä¾˜ä½»ä½©ä½°ä¾‘ä½¯ä¾†ä¾–å„˜ä¿”ä¿Ÿä¿ä¿˜ä¿›ä¿‘ä¿šä¿ä¿¤ä¿¥å€šå€¨å€”å€ªå€¥å€…ä¼œä¿¶å€¡å€©å€¬ä¿¾ä¿¯å€‘å€†åƒå‡æœƒå•ååˆåšå–å¬å¸å‚€å‚šå‚…å‚´å‚²åƒ‰åƒŠå‚³åƒ‚åƒ–åƒåƒ¥åƒ­åƒ£åƒ®åƒ¹åƒµå„‰å„å„‚å„–å„•å„”å„šå„¡å„ºå„·å„¼å„»å„¿å…€å…’å…Œå…”å…¢ç«¸å…©å…ªå…®å†€å†‚å›˜å†Œå†‰å†å†‘å†“å†•å†–å†¤å†¦å†¢å†©å†ªå†«å†³å†±å†²å†°å†µå†½å‡…å‡‰å‡›å‡ è™•å‡©å‡­å‡°å‡µå‡¾åˆ„åˆ‹åˆ”åˆåˆ§åˆªåˆ®åˆ³åˆ¹å‰å‰„å‰‹å‰Œå‰å‰”å‰ªå‰´å‰©å‰³å‰¿å‰½åŠåŠ”åŠ’å‰±åŠˆåŠ‘è¾¨è¾§åŠ¬åŠ­åŠ¼åŠµå‹å‹å‹—å‹å‹£å‹¦é£­å‹ å‹³å‹µå‹¸å‹¹åŒ†åŒˆç”¸åŒåŒåŒåŒ•åŒšåŒ£åŒ¯åŒ±åŒ³åŒ¸å€å†å…ä¸—å‰åå‡–åå©å®å¤˜å»å·å‚å–å å¦å¥å®å°å¶åƒç°’é›™åŸæ›¼ç‡®å®å¨å­åºåå½å‘€å¬å­å¼å®å¶å©åå‘å’å‘µå’å‘Ÿå‘±å‘·å‘°å’’å‘»å’€å‘¶å’„å’å’†å“‡å’¢å’¸å’¥å’¬å“„å“ˆå’¨å’«å“‚å’¤å’¾å’¼å“˜å“¥å“¦å”å””å“½å“®å“­å“ºå“¢å”¹å•€å•£å•Œå”®å•œå•…å•–å•—å”¸å”³å•å–™å–€å’¯å–Šå–Ÿå•»å•¾å–˜å–å–®å•¼å–ƒå–©å–‡å–¨å—šå—…å—Ÿå—„å—œå—¤å—”å˜”å—·å˜–å—¾å—½å˜›å—¹å™å™ç‡Ÿå˜´å˜¶å˜²å˜¸å™«å™¤å˜¯å™¬å™ªåš†åš€åšŠåš åš”åšåš¥åš®åš¶åš´å›‚åš¼å›å›ƒå›€å›ˆå›å›‘å›“å›—å›®å›¹åœ€å›¿åœ„åœ‰åœˆåœ‹åœåœ“åœ˜åœ–å—‡åœœåœ¦åœ·åœ¸ååœ»å€åå©åŸ€åˆå¡å¿å‰å“å å³å¤åªå°åŸƒåŸ†åŸ”åŸ’åŸ“å ŠåŸ–åŸ£å ‹å ™å å¡²å ¡å¡¢å¡‹å¡°æ¯€å¡’å ½å¡¹å¢…å¢¹å¢Ÿå¢«å¢ºå£å¢»å¢¸å¢®å£…å£“å£‘å£—å£™å£˜å£¥å£œå£¤å£Ÿå£¯å£ºå£¹å£»å£¼å£½å¤‚å¤Šå¤å¤›æ¢¦å¤¥å¤¬å¤­å¤²å¤¸å¤¾ç«’å¥•å¥å¥å¥šå¥˜å¥¢å¥ å¥§å¥¬å¥©å¥¸å¦å¦ä½ä¾«å¦£å¦²å§†å§¨å§œå¦å§™å§šå¨¥å¨Ÿå¨‘å¨œå¨‰å¨šå©€å©¬å©‰å¨µå¨¶å©¢å©ªåªšåª¼åª¾å«‹å«‚åª½å«£å«—å«¦å«©å«–å«ºå«»å¬Œå¬‹å¬–å¬²å«å¬ªå¬¶å¬¾å­ƒå­…å­€å­‘å­•å­šå­›å­¥å­©å­°å­³å­µå­¸æ–ˆå­ºå®€å®ƒå®¦å®¸å¯ƒå¯‡å¯‰å¯”å¯å¯¤å¯¦å¯¢å¯å¯¥å¯«å¯°å¯¶å¯³å°…å°‡å°ˆå°å°“å° å°¢å°¨å°¸å°¹å±å±†å±å±“å±å±å­±å±¬å±®ä¹¢å±¶å±¹å²Œå²‘å²”å¦›å²«å²»å²¶å²¼å²·å³…å²¾å³‡å³™å³©å³½å³ºå³­å¶Œå³ªå´‹å´•å´—åµœå´Ÿå´›å´‘å´”å´¢å´šå´™å´˜åµŒåµ’åµåµ‹åµ¬åµ³åµ¶å¶‡å¶„å¶‚å¶¢å¶å¶¬å¶®å¶½å¶å¶·å¶¼å·‰å·å·“å·’å·–å·›å·«å·²å·µå¸‹å¸šå¸™å¸‘å¸›å¸¶å¸·å¹„å¹ƒå¹€å¹å¹—å¹”å¹Ÿå¹¢å¹¤å¹‡å¹µå¹¶å¹ºéº¼å¹¿åº å»å»‚å»ˆå»å»å»–å»£å»å»šå»›å»¢å»¡å»¨å»©å»¬å»±å»³å»°å»´å»¸å»¾å¼ƒå¼‰å½å½œå¼‹å¼‘å¼–å¼©å¼­å¼¸å½å½ˆå½Œå½å¼¯å½‘å½–å½—å½™å½¡å½­å½³å½·å¾ƒå¾‚å½¿å¾Šå¾ˆå¾‘å¾‡å¾å¾™å¾˜å¾ å¾¨å¾­å¾¼å¿–å¿»å¿¤å¿¸å¿±å¿æ‚³å¿¿æ€¡æ æ€™æ€æ€©æ€æ€±æ€›æ€•æ€«æ€¦æ€æ€ºæšææªæ·æŸæŠæ†ææ£æƒæ¤æ‚æ¬æ«æ™æ‚æ‚æƒ§æ‚ƒæ‚šæ‚„æ‚›æ‚–æ‚—æ‚’æ‚§æ‚‹æƒ¡æ‚¸æƒ æƒ“æ‚´å¿°æ‚½æƒ†æ‚µæƒ˜æ…æ„•æ„†æƒ¶æƒ·æ„€æƒ´æƒºæ„ƒæ„¡æƒ»æƒ±æ„æ„æ…‡æ„¾æ„¨æ„§æ…Šæ„¿æ„¼æ„¬æ„´æ„½æ…‚æ…„æ…³æ…·æ…˜æ…™æ…šæ…«æ…´æ…¯æ…¥æ…±æ…Ÿæ…æ…“æ…µæ†™æ†–æ†‡æ†¬æ†”æ†šæ†Šæ†‘æ†«æ†®æ‡Œæ‡Šæ‡‰æ‡·æ‡ˆæ‡ƒæ‡†æ†ºæ‡‹ç½¹æ‡æ‡¦æ‡£æ‡¶æ‡ºæ‡´æ‡¿æ‡½æ‡¼æ‡¾æˆ€æˆˆæˆ‰æˆæˆŒæˆ”æˆ›æˆæˆ¡æˆªæˆ®æˆ°æˆ²æˆ³æ‰æ‰æ‰æ‰£æ‰›æ‰ æ‰¨æ‰¼æŠ‚æŠ‰æ‰¾æŠ’æŠ“æŠ–æ‹”æŠƒæŠ”æ‹—æ‹‘æŠ»æ‹æ‹¿æ‹†æ“”æ‹ˆæ‹œæ‹Œæ‹Šæ‹‚æ‹‡æŠ›æ‹‰æŒŒæ‹®æ‹±æŒ§æŒ‚æŒˆæ‹¯æ‹µææŒ¾ææœææ–ææ€æ«æ¶æ£ææ‰æŸæµæ«æ©æ¾æ©æ€æ†æ£æ‰æ’æ¶æ„æ–æ´æ†æ“æ¦æ¶æ”æ—æ¨ææ‘§æ‘¯æ‘¶æ‘æ”ªæ’•æ’“æ’¥æ’©æ’ˆæ’¼æ“šæ“’æ“…æ“‡æ’»æ“˜æ“‚æ“±æ“§èˆ‰æ“ æ“¡æŠ¬æ“£æ“¯æ”¬æ“¶æ“´æ“²æ“ºæ”€æ“½æ”˜æ”œæ”…æ”¤æ”£æ”«æ”´æ”µæ”·æ”¶æ”¸ç•‹æ•ˆæ•–æ••æ•æ•˜æ•æ•æ•²æ•¸æ–‚æ–ƒè®Šæ–›æ–Ÿæ–«æ–·æ—ƒæ—†æ—æ—„æ—Œæ—’æ—›æ—™æ— æ—¡æ—±æ²æ˜Šæ˜ƒæ—»æ³æ˜µæ˜¶æ˜´æ˜œæ™æ™„æ™‰æ™æ™æ™æ™¤æ™§æ™¨æ™Ÿæ™¢æ™°æšƒæšˆæšæš‰æš„æš˜æšæ›æš¹æ›‰æš¾æš¼æ›„æš¸æ›–æ›šæ› æ˜¿æ›¦æ›©æ›°æ›µæ›·æœæœ–æœæœ¦æœ§éœ¸æœ®æœ¿æœ¶ææœ¸æœ·æ†ææ æ™æ£æ¤æ‰æ°æ©æ¼æªæŒæ‹æ¦æ¡æ…æ·æŸ¯æ´æŸ¬æ³æŸ©æ¸æŸ¤æŸæŸæŸ¢æŸ®æ¹æŸæŸ†æŸ§æªœæ æ¡†æ ©æ¡€æ¡æ ²æ¡æ¢³æ «æ¡™æ¡£æ¡·æ¡¿æ¢Ÿæ¢æ¢­æ¢”æ¢æ¢›æ¢ƒæª®æ¢¹æ¡´æ¢µæ¢ æ¢ºæ¤æ¢æ¡¾æ¤æ£Šæ¤ˆæ£˜æ¤¢æ¤¦æ£¡æ¤Œæ£æ£”æ£§æ£•æ¤¶æ¤’æ¤„æ£—æ££æ¤¥æ£¹æ£ æ£¯æ¤¨æ¤ªæ¤šæ¤£æ¤¡æ£†æ¥¹æ¥·æ¥œæ¥¸æ¥«æ¥”æ¥¾æ¥®æ¤¹æ¥´æ¤½æ¥™æ¤°æ¥¡æ¥æ¥æ¦æ¥ªæ¦²æ¦®æ§æ¦¿æ§æ§“æ¦¾æ§å¯¨æ§Šæ§æ¦»æ§ƒæ¦§æ¨®æ¦‘æ¦ æ¦œæ¦•æ¦´æ§æ§¨æ¨‚æ¨›æ§¿æ¬Šæ§¹æ§²æ§§æ¨…æ¦±æ¨æ§­æ¨”æ§«æ¨Šæ¨’æ«æ¨£æ¨“æ©„æ¨Œæ©²æ¨¶æ©¸æ©‡æ©¢æ©™æ©¦æ©ˆæ¨¸æ¨¢æªæªæª æª„æª¢æª£æª—è˜—æª»æ«ƒæ«‚æª¸æª³æª¬æ«æ«‘æ«Ÿæªªæ«šæ«ªæ«»æ¬…è˜–æ«ºæ¬’æ¬–é¬±æ¬Ÿæ¬¸æ¬·ç›œæ¬¹é£®æ­‡æ­ƒæ­‰æ­æ­™æ­”æ­›æ­Ÿæ­¡æ­¸æ­¹æ­¿æ®€æ®„æ®ƒæ®æ®˜æ®•æ®æ®¤æ®ªæ®«æ®¯æ®²æ®±æ®³æ®·æ®¼æ¯†æ¯‹æ¯“æ¯Ÿæ¯¬æ¯«æ¯³æ¯¯éº¾æ°ˆæ°“æ°”æ°›æ°¤æ°£æ±æ±•æ±¢æ±ªæ²‚æ²æ²šæ²æ²›æ±¾æ±¨æ±³æ²’æ²æ³„æ³±æ³“æ²½æ³—æ³…æ³æ²®æ²±æ²¾æ²ºæ³›æ³¯æ³™æ³ªæ´Ÿè¡æ´¶æ´«æ´½æ´¸æ´™æ´µæ´³æ´’æ´Œæµ£æ¶“æµ¤æµšæµ¹æµ™æ¶æ¶•æ¿¤æ¶…æ·¹æ¸•æ¸Šæ¶µæ·‡æ·¦æ¶¸æ·†æ·¬æ·æ·Œæ·¨æ·’æ·…æ·ºæ·™æ·¤æ·•æ·ªæ·®æ¸­æ¹®æ¸®æ¸™æ¹²æ¹Ÿæ¸¾æ¸£æ¹«æ¸«æ¹¶æ¹æ¸Ÿæ¹ƒæ¸ºæ¹æ¸¤æ»¿æ¸æ¸¸æº‚æºªæº˜æ»‰æº·æ»“æº½æº¯æ»„æº²æ»”æ»•æºæº¥æ»‚æºŸæ½æ¼‘çŒæ»¬æ»¸æ»¾æ¼¿æ»²æ¼±æ»¯æ¼²æ»Œæ¼¾æ¼“æ»·æ¾†æ½ºæ½¸æ¾æ¾€æ½¯æ½›æ¿³æ½­æ¾‚æ½¼æ½˜æ¾æ¾‘æ¿‚æ½¦æ¾³æ¾£æ¾¡æ¾¤æ¾¹æ¿†æ¾ªæ¿Ÿæ¿•æ¿¬æ¿”æ¿˜æ¿±æ¿®æ¿›ç€‰ç€‹æ¿ºç€‘ç€ç€æ¿¾ç€›ç€šæ½´ç€ç€˜ç€Ÿç€°ç€¾ç€²ç‘ç£ç‚™ç‚’ç‚¯çƒ±ç‚¬ç‚¸ç‚³ç‚®çƒŸçƒ‹çƒçƒ™ç„‰çƒ½ç„œç„™ç…¥ç…•ç†ˆç…¦ç…¢ç…Œç…–ç…¬ç†ç‡»ç†„ç†•ç†¨ç†¬ç‡—ç†¹ç†¾ç‡’ç‡‰ç‡”ç‡ç‡ ç‡¬ç‡§ç‡µç‡¼ç‡¹ç‡¿çˆçˆçˆ›çˆ¨çˆ­çˆ¬çˆ°çˆ²çˆ»çˆ¼çˆ¿ç‰€ç‰†ç‰‹ç‰˜ç‰´ç‰¾çŠ‚çŠçŠ‡çŠ’çŠ–çŠ¢çŠ§çŠ¹çŠ²ç‹ƒç‹†ç‹„ç‹ç‹’ç‹¢ç‹ ç‹¡ç‹¹ç‹·å€çŒ—çŒŠçŒœçŒ–çŒçŒ´çŒ¯çŒ©çŒ¥çŒ¾ççé»˜ç—çªç¨ç°ç¸çµç»çºçˆç³çç»ç€ç¥ç®çç’¢ç…ç‘¯ç¥ç¸ç²çºç‘•ç¿ç‘Ÿç‘™ç‘ç‘œç‘©ç‘°ç‘£ç‘ªç‘¶ç‘¾ç’‹ç’ç’§ç“Šç“ç“”ç±ç“ ç“£ç“§ç“©ç“®ç“²ç“°ç“±ç“¸ç“·ç”„ç”ƒç”…ç”Œç”ç”ç”•ç”“ç”ç”¦ç”¬ç”¼ç•„ç•ç•Šç•‰ç•›ç•†ç•šç•©ç•¤ç•§ç•«ç•­ç•¸ç•¶ç–†ç–‡ç•´ç–Šç–‰ç–‚ç–”ç–šç–ç–¥ç–£ç—‚ç–³ç—ƒç–µç–½ç–¸ç–¼ç–±ç—ç—Šç—’ç—™ç—£ç—ç—¾ç—¿ç—¼ç˜ç—°ç—ºç—²ç—³ç˜‹ç˜ç˜‰ç˜Ÿç˜§ç˜ ç˜¡ç˜¢ç˜¤ç˜´ç˜°ç˜»ç™‡ç™ˆç™†ç™œç™˜ç™¡ç™¢ç™¨ç™©ç™ªç™§ç™¬ç™°ç™²ç™¶ç™¸ç™¼çš€çšƒçšˆçš‹çšçš–çš“çš™çššçš°çš´çš¸çš¹çšºç›‚ç›ç›–ç›’ç›ç›¡ç›¥ç›§ç›ªè˜¯ç›»çœˆçœ‡çœ„çœ©çœ¤çœçœ¥çœ¦çœ›çœ·çœ¸ç‡çšç¨ç«ç›ç¥ç¿ç¾ç¹çç‹ç‘ç çç°ç¶ç¹ç¿ç¼ç½ç»çŸ‡çŸçŸ—çŸšçŸœçŸ£çŸ®çŸ¼ç Œç ’ç¤¦ç  ç¤ªç¡…ç¢ç¡´ç¢†ç¡¼ç¢šç¢Œç¢£ç¢µç¢ªç¢¯ç£‘ç£†ç£‹ç£”ç¢¾ç¢¼ç£…ç£Šç£¬ç£§ç£šç£½ç£´ç¤‡ç¤’ç¤‘ç¤™ç¤¬ç¤«ç¥€ç¥ ç¥—ç¥Ÿç¥šç¥•ç¥“ç¥ºç¥¿ç¦Šç¦ç¦§é½‹ç¦ªç¦®ç¦³ç¦¹ç¦ºç§‰ç§•ç§§ç§¬ç§¡ç§£ç¨ˆç¨ç¨˜ç¨™ç¨ ç¨Ÿç¦€ç¨±ç¨»ç¨¾ç¨·ç©ƒç©—ç©‰ç©¡ç©¢ç©©é¾ç©°ç©¹ç©½çªˆçª—çª•çª˜çª–çª©ç«ˆçª°çª¶ç«…ç«„çª¿é‚ƒç«‡ç«Šç«ç«ç«•ç«“ç«™ç«šç«ç«¡ç«¢ç«¦ç«­ç«°ç¬‚ç¬ç¬Šç¬†ç¬³ç¬˜ç¬™ç¬ç¬µç¬¨ç¬¶ç­ç­ºç¬„ç­ç¬‹ç­Œç­…ç­µç­¥ç­´ç­§ç­°ç­±ç­¬ç­®ç®ç®˜ç®Ÿç®ç®œç®šç®‹ç®’ç®ç­ç®™ç¯‹ç¯ç¯Œç¯ç®´ç¯†ç¯ç¯©ç°‘ç°”ç¯¦ç¯¥ç± ç°€ç°‡ç°“ç¯³ç¯·ç°—ç°ç¯¶ç°£ç°§ç°ªç°Ÿç°·ç°«ç°½ç±Œç±ƒç±”ç±ç±€ç±ç±˜ç±Ÿç±¤ç±–ç±¥ç±¬ç±µç²ƒç²ç²¤ç²­ç²¢ç²«ç²¡ç²¨ç²³ç²²ç²±ç²®ç²¹ç²½ç³€ç³…ç³‚ç³˜ç³’ç³œç³¢é¬»ç³¯ç³²ç³´ç³¶ç³ºç´†ç´‚ç´œç´•ç´Šçµ…çµ‹ç´®ç´²ç´¿ç´µçµ†çµ³çµ–çµçµ²çµ¨çµ®çµçµ£ç¶“ç¶‰çµ›ç¶çµ½ç¶›ç¶ºç¶®ç¶£ç¶µç·‡ç¶½ç¶«ç¸½ç¶¢ç¶¯ç·œç¶¸ç¶Ÿç¶°ç·˜ç·ç·¤ç·ç·»ç·²ç·¡ç¸…ç¸Šç¸£ç¸¡ç¸’ç¸±ç¸Ÿç¸‰ç¸‹ç¸¢ç¹†ç¹¦ç¸»ç¸µç¸¹ç¹ƒç¸·ç¸²ç¸ºç¹§ç¹ç¹–ç¹ç¹™ç¹šç¹¹ç¹ªç¹©ç¹¼ç¹»çºƒç·•ç¹½è¾®ç¹¿çºˆçº‰çºŒçº’çºçº“çº”çº–çºçº›çºœç¼¸ç¼ºç½…ç½Œç½ç½ç½ç½‘ç½•ç½”ç½˜ç½Ÿç½ ç½¨ç½©ç½§ç½¸ç¾‚ç¾†ç¾ƒç¾ˆç¾‡ç¾Œç¾”ç¾ç¾ç¾šç¾£ç¾¯ç¾²ç¾¹ç¾®ç¾¶ç¾¸è­±ç¿…ç¿†ç¿Šç¿•ç¿”ç¿¡ç¿¦ç¿©ç¿³ç¿¹é£œè€†è€„è€‹è€’è€˜è€™è€œè€¡è€¨è€¿è€»èŠè†è’è˜èšèŸè¢è¨è³è²è°è¶è¹è½è¿è‚„è‚†è‚…è‚›è‚“è‚šè‚­å†è‚¬èƒ›èƒ¥èƒ™èƒèƒ„èƒšèƒ–è„‰èƒ¯èƒ±è„›è„©è„£è„¯è…‹éš‹è…†è„¾è…“è…‘èƒ¼è…±è…®è…¥è…¦è…´è†ƒè†ˆè†Šè†€è†‚è† è†•è†¤è†£è…Ÿè†“è†©è†°è†µè†¾è†¸è†½è‡€è‡‚è†ºè‡‰è‡è‡‘è‡™è‡˜è‡ˆè‡šè‡Ÿè‡ è‡§è‡ºè‡»è‡¾èˆèˆ‚èˆ…èˆ‡èˆŠèˆèˆèˆ–èˆ©èˆ«èˆ¸èˆ³è‰€è‰™è‰˜è‰è‰šè‰Ÿè‰¤è‰¢è‰¨è‰ªè‰«èˆ®è‰±è‰·è‰¸è‰¾èŠèŠ’èŠ«èŠŸèŠ»èŠ¬è‹¡è‹£è‹Ÿè‹’è‹´è‹³è‹ºè“èŒƒè‹»è‹¹è‹èŒ†è‹œèŒ‰è‹™èŒµèŒ´èŒ–èŒ²èŒ±è€èŒ¹èè…èŒ¯èŒ«èŒ—èŒ˜è…èšèªèŸè¢è–èŒ£èè‡èŠè¼èµè³èµè è‰è¨è´è“è«èè½èƒè˜è‹èè·è‡è è²èè¢è è½è¸è”†è»è‘­èªè¼è•šè’„è‘·è‘«è’­è‘®è’‚è‘©è‘†è¬è‘¯è‘¹èµè“Šè‘¢è’¹è’¿è’Ÿè“™è“è’»è“šè“è“è“†è“–è’¡è”¡è“¿è“´è”—è”˜è”¬è”Ÿè”•è””è“¼è•€è•£è•˜è•ˆè•è˜‚è•‹è••è–€è–¤è–ˆè–‘è–Šè–¨è•­è–”è–›è—ªè–‡è–œè•·è•¾è–è—‰è–ºè—è–¹è—è—•è—è—¥è—œè—¹è˜Šè˜“è˜‹è—¾è—ºè˜†è˜¢è˜šè˜°è˜¿è™ä¹•è™”è™Ÿè™§è™±èš“èš£èš©èšªèš‹èšŒèš¶èš¯è›„è›†èš°è›‰è £èš«è›”è›è›©è›¬è›Ÿè››è›¯èœ’èœ†èœˆèœ€èœƒè›»èœ‘èœ‰èœè›¹èœŠèœ´èœ¿èœ·èœ»èœ¥èœ©èœšè èŸè¸èŒèè´è—è¨è®è™è“è£èªè …è¢èŸè‚è¯èŸ‹è½èŸ€èŸé›–è«èŸ„è³èŸ‡èŸ†è»èŸ¯èŸ²èŸ è è èŸ¾èŸ¶èŸ·è èŸ’è ‘è –è •è ¢è ¡è ±è ¶è ¹è §è »è¡„è¡‚è¡’è¡™è¡è¡¢è¡«è¢è¡¾è¢è¡µè¡½è¢µè¡²è¢‚è¢—è¢’è¢®è¢™è¢¢è¢è¢¤è¢°è¢¿è¢±è£ƒè£„è£”è£˜è£™è£è£¹è¤‚è£¼è£´è£¨è£²è¤„è¤Œè¤Šè¤“è¥ƒè¤è¤¥è¤ªè¤«è¥è¥„è¤»è¤¶è¤¸è¥Œè¤è¥ è¥è¥¦è¥¤è¥­è¥ªè¥¯è¥´è¥·è¥¾è¦ƒè¦ˆè¦Šè¦“è¦˜è¦¡è¦©è¦¦è¦¬è¦¯è¦²è¦ºè¦½è¦¿è§€è§šè§œè§è§§è§´è§¸è¨ƒè¨–è¨è¨Œè¨›è¨è¨¥è¨¶è©è©›è©’è©†è©ˆè©¼è©­è©¬è©¢èª…èª‚èª„èª¨èª¡èª‘èª¥èª¦èªšèª£è«„è«è«‚è«šè««è«³è«§è«¤è«±è¬”è« è«¢è«·è«è«›è¬Œè¬‡è¬šè«¡è¬–è¬è¬—è¬ è¬³é«è¬¦è¬«è¬¾è¬¨è­è­Œè­è­è­‰è­–è­›è­šè­«è­Ÿè­¬è­¯è­´è­½è®€è®Œè®è®’è®“è®–è®™è®šè°ºè±è°¿è±ˆè±Œè±è±è±•è±¢è±¬è±¸è±ºè²‚è²‰è²…è²Šè²è²è²”è±¼è²˜æˆè²­è²ªè²½è²²è²³è²®è²¶è³ˆè³è³¤è³£è³šè³½è³ºè³»è´„è´…è´Šè´‡è´è´è´é½è´“è³è´”è´–èµ§èµ­èµ±èµ³è¶è¶™è·‚è¶¾è¶ºè·è·šè·–è·Œè·›è·‹è·ªè·«è·Ÿè·£è·¼è¸ˆè¸‰è·¿è¸è¸è¸è¸Ÿè¹‚è¸µè¸°è¸´è¹Šè¹‡è¹‰è¹Œè¹è¹ˆè¹™è¹¤è¹ è¸ªè¹£è¹•è¹¶è¹²è¹¼èºèº‡èº…èº„èº‹èºŠèº“èº‘èº”èº™èºªèº¡èº¬èº°è»†èº±èº¾è»…è»ˆè»‹è»›è»£è»¼è»»è»«è»¾è¼Šè¼…è¼•è¼’è¼™è¼“è¼œè¼Ÿè¼›è¼Œè¼¦è¼³è¼»è¼¹è½…è½‚è¼¾è½Œè½‰è½†è½è½—è½œè½¢è½£è½¤è¾œè¾Ÿè¾£è¾­è¾¯è¾·è¿šè¿¥è¿¢è¿ªè¿¯é‚‡è¿´é€…è¿¹è¿ºé€‘é€•é€¡é€é€é€–é€‹é€§é€¶é€µé€¹è¿¸ééé‘é’é€é‰é€¾é–é˜éé¨é¯é¶éš¨é²é‚‚é½é‚é‚€é‚Šé‚‰é‚é‚¨é‚¯é‚±é‚µéƒ¢éƒ¤æ‰ˆéƒ›é„‚é„’é„™é„²é„°é…Šé…–é…˜é…£é…¥é…©é…³é…²é†‹é†‰é†‚é†¢é†«é†¯é†ªé†µé†´é†ºé‡€é‡é‡‰é‡‹é‡é‡–é‡Ÿé‡¡é‡›é‡¼é‡µé‡¶éˆé‡¿éˆ”éˆ¬éˆ•éˆ‘é‰é‰—é‰…é‰‰é‰¤é‰ˆéŠ•éˆ¿é‰‹é‰éŠœéŠ–éŠ“éŠ›é‰šé‹éŠ¹éŠ·é‹©éŒé‹ºé„éŒ®éŒ™éŒ¢éŒšéŒ£éŒºéŒµéŒ»éœé é¼é®é–é°é¬é­é”é¹é–é—é¨é¥é˜éƒéééˆé¤éšé”é“éƒé‡éé¶é«éµé¡éºé‘é‘’é‘„é‘›é‘ é‘¢é‘é‘ªéˆ©é‘°é‘µé‘·é‘½é‘šé‘¼é‘¾é’é‘¿é–‚é–‡é–Šé–”é––é–˜é–™é– é–¨é–§é–­é–¼é–»é–¹é–¾é—Šæ¿¶é—ƒé—é—Œé—•é—”é—–é—œé—¡é—¥é—¢é˜¡é˜¨é˜®é˜¯é™‚é™Œé™é™‹é™·é™œé™é™é™Ÿé™¦é™²é™¬éšéš˜éš•éš—éšªéš§éš±éš²éš°éš´éš¶éš¸éš¹é›é›‹é›‰é›è¥é›œéœé›•é›¹éœ„éœ†éœˆéœ“éœéœ‘éœéœ–éœ™éœ¤éœªéœ°éœ¹éœ½éœ¾é„é†éˆé‚é‰éœé é¤é¦é¨å‹’é«é±é¹é…é¼ééºé†é‹éééœé¨é¦é£é³é´éŸƒéŸ†éŸˆéŸ‹éŸœéŸ­é½éŸ²ç«ŸéŸ¶éŸµé é Œé ¸é ¤é ¡é ·é ½é¡†é¡é¡‹é¡«é¡¯é¡°é¡±é¡´é¡³é¢ªé¢¯é¢±é¢¶é£„é£ƒé£†é£©é£«é¤ƒé¤‰é¤’é¤”é¤˜é¤¡é¤é¤é¤¤é¤ é¤¬é¤®é¤½é¤¾é¥‚é¥‰é¥…é¥é¥‹é¥‘é¥’é¥Œé¥•é¦—é¦˜é¦¥é¦­é¦®é¦¼é§Ÿé§›é§é§˜é§‘é§­é§®é§±é§²é§»é§¸é¨é¨é¨…é§¢é¨™é¨«é¨·é©…é©‚é©€é©ƒé¨¾é©•é©é©›é©—é©Ÿé©¢é©¥é©¤é©©é©«é©ªéª­éª°éª¼é«€é«é«‘é«“é«”é«é«Ÿé«¢é«£é«¦é«¯é««é«®é«´é«±é«·é«»é¬†é¬˜é¬šé¬Ÿé¬¢é¬£é¬¥é¬§é¬¨é¬©é¬ªé¬®é¬¯é¬²é­„é­ƒé­é­é­é­‘é­˜é­´é®“é®ƒé®‘é®–é®—é®Ÿé® é®¨é®´é¯€é¯Šé®¹é¯†é¯é¯‘é¯’é¯£é¯¢é¯¤é¯”é¯¡é°ºé¯²é¯±é¯°é°•é°”é°‰é°“é°Œé°†é°ˆé°’é°Šé°„é°®é°›é°¥é°¤é°¡é°°é±‡é°²é±†é°¾é±šé± é±§é±¶é±¸é³§é³¬é³°é´‰é´ˆé³«é´ƒé´†é´ªé´¦é¶¯é´£é´Ÿéµ„é´•é´’éµé´¿é´¾éµ†éµˆéµéµéµ¤éµ‘éµéµ™éµ²é¶‰é¶‡é¶«éµ¯éµºé¶šé¶¤é¶©é¶²é·„é·é¶»é¶¸é¶ºé·†é·é·‚é·™é·“é·¸é·¦é·­é·¯é·½é¸šé¸›é¸é¹µé¹¹é¹½éºéºˆéº‹éºŒéº’éº•éº‘éºéº¥éº©éº¸éºªéº­é¡é»Œé»é»é»é»”é»œé»é»é» é»¥é»¨é»¯é»´é»¶é»·é»¹é»»é»¼é»½é¼‡é¼ˆçš·é¼•é¼¡é¼¬é¼¾é½Šé½’é½”é½£é½Ÿé½ é½¡é½¦é½§é½¬é½ªé½·é½²é½¶é¾•é¾œé¾ å ¯æ§‡é™ç‘¤å‡œç†™"

bot.gguide = """æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆåˆ©ç”¨è¦ç´„ æœ€çµ‚æ›´æ–° 2019/05/27

1.æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆ(ä»¥ä¸‹ã€Œã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆã€ã¨ã™ã‚‹)ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ãŸæ™‚ç‚¹ã§ã€ã“ã®è¦ç´„ã«åŒæ„ã—ãŸã‚‚ã®ã¨ã™ã‚‹ã€‚
2.è¦ç´„é•åè€…ã¯
  ä¸€å›ç›®:è­¦å‘Š
  äºŒå›ç›®:ä¸€é€±é–“ä½¿ç”¨ç¦æ­¢
  ä¸‰å›ç›®:æ°¸ä¹…ä½¿ç”¨ç¦æ­¢
  ã‚’åŸå‰‡ã¨ã™ã‚‹ã€‚ä½¿ç”¨ç¦æ­¢ä¸­ã«ã€ã‚µãƒ–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãªã©ã§ã®ç¦æ­¢å›é¿ã¯åˆ¤æ˜ã—æ¬¡ç¬¬ã€ãƒ¡ã‚¤ãƒ³ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã‚µãƒ–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã‚‚ã«æ°¸ä¹…ä½¿ç”¨ç¦æ­¢ã¨ã™ã‚‹ã€‚
3.ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ†ã‚­ã‚¹ãƒˆã€ç”»åƒã€ãã®ã‚ˆã†ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã¤ãªãŒã‚‹URLã‚’æŠ•ç¨¿ã™ã‚‹ã“ã¨ã‚’ç¦æ­¢ã™ã‚‹ã€‚ãŸã ã—ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆä½œæˆè€…ã€ãŠã‚ˆã³ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€ç®¡ç†é‹å–¶ã«å¿…è¦ãªå ´åˆã¯ã€æŠ•ç¨¿ã—ã¦ã‚‚ã‚ˆã„ã¨ã™ã‚‹ã€‚
  ãƒ»å¹´é½¢åˆ¶é™ã®å¿…è¦ãªã‚‚ã®
  ãƒ»é–²è¦§ã«é‡‘éŠ­ã‚„å€‹äººæƒ…å ±ãŒå¿…è¦ãªã‚‚ã®(ãŸã ã—ã€ã“ã‚Œã«ã‚ˆã£ã¦æŠ•ç¨¿ãªã©ã«ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ãªã‚µã‚¤ãƒˆã®ãƒªãƒ³ã‚¯æŠ•ç¨¿ã‚’åˆ¶é™ã™ã‚‹ã‚‚ã®ã§ã¯ãªã„)
  ãƒ»Discordã®ã‚µãƒ¼ãƒãƒ¼æ‹›å¾…ã€‚ãŸã ã—æ–°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã®ãŸã‚ã«ã€ã€Œæ€æƒŸå¥ˆã¡ã‚ƒã‚“æ›´æ–°é–¢ä¿‚ã‚µãƒ¼ãƒãƒ¼ã€ã«èª˜å°ã™ã‚‹å ´åˆãªã©ã€ä¸€éƒ¨ã®ä¾‹å¤–ã‚’é™¤ãã€‚ã“ã‚Œã«ã‚ˆã£ã¦ä»–ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒ³ãƒãƒ«åã®é€ä¿¡ã‚’ç¦æ­¢ã™ã‚‹ã‚‚ã®ã§ã¯ãªã„ã€‚
  ãƒ»æ„å‘³ã®ãªã„æ–‡å­—åˆ—ã®ç¾…åˆ—ã€‚ãŸã ã—ã€æ¥ç¶šãƒ†ã‚¹ãƒˆã®å ´åˆã‚’é™¤ãã€‚
  ãƒ»ãã®ä»–æ³•å¾‹ã€Discordåˆ©ç”¨è¦ç´„ã«é•åã™ã‚‹ã‚‚ã®
4.ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆè£½ä½œè€…ãŠã‚ˆã³ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€åˆ©ç”¨è€…ã®ã§ãã‚‹ã“ã¨ã«åŠ ãˆã¦ã€æ¬¡ã®è¡Œç‚ºã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã€‚
  ãƒ»role(è‚©æ›¸)ã®å¤‰æ›´
  (æœ¬äººã‹ã‚‰ã®ä¾é ¼ãªã©ã®å ´åˆã€‚ãŸã ã—ã€ä¸€éƒ¨æ–‡å­—åˆ—ã¯ãªã‚Šã™ã¾ã—é˜²æ­¢ã®ãŸã‚ã«å´ä¸‹ã•ã‚Œã‚‹ã€‚)
  ãƒ»åˆ©ç”¨è€…ã®ä½¿ç”¨ç¦æ­¢çŠ¶æ…‹ã®åˆ‡ã‚Šæ›¿ãˆ
  ãƒ»æŠ•ç¨¿ã®å‰Šé™¤
  ä¸ŠäºŒã¤ã®è¡Œç‚ºã‚’è¡Œã†ã®ã¯ã€å‰é …ã®é …ç›®ã«ã‚ã‚‹æŠ•ç¨¿ãŒè¡Œã‚ã‚ŒãŸå ´åˆã‚„ã€è£½ä½œè€…ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼ã®è©±ã—åˆã„ã®çµæœã€ä¸é©åˆ‡ã ã¨åˆ¤æ–­ã•ã‚ŒãŸã‚‚ã®ã®å ´åˆã«é™ã‚‹
5.ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆã«ã¦ã€ã»ã‹ã®ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã‚‹é …ç›®ã¯ã€ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã‚ã‚‹ã€‚
  ãƒ»(ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å ´åˆ)ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã€ä»˜å±ã™ã‚‹embedã€æ·»ä»˜ã•ã‚ŒãŸç”»åƒ(ãŸã ã—ä¸€æšã®ã¿)
  ãƒ»(ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å ´åˆ)ã¤ã‘ãŸ/å¤–ã—ãŸãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®idã€æŠ•ç¨¿æ™‚ã«ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ãªã„ãƒ‡ãƒã‚¤ã‚¹(PC,moblie,webã®ä¸‰é€šã‚Š)
  ãƒ»é€ä¿¡ã—ãŸã‚µãƒ¼ãƒãƒ¼ã®åå‰ã€ã‚¢ã‚¤ã‚³ãƒ³ã€id
  ãƒ»é€ä¿¡å…ˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸idä¸€è¦§
  ãƒ»æŠ•ç¨¿æ™‚é–“
6.ã“ã®è¦ç´„ã¯`s-globalguide`ã§ã„ã¤ã§ã‚‚è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
7.æ”¹å®š
  ãƒ»åˆ¶ä½œè€…ãŒäºˆå‘Šãªã—ã«æ”¹å®šã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚æ”¹å®šå¾Œã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆã«ã¦å ±å‘Šã•ã‚Œã‚‹ã€‚
  ãƒ»äºˆå‘Šã—ã¦æ”¹å®šã—ãŸå ´åˆã‚‚ã€åŒã˜ã‚ˆã†ã«æ”¹å®šå¾Œã«å ±å‘Šã™ã‚‹ã€‚
"""

bot.load_extension("cogs.apple_misc")
bot.load_extension("cogs.apple_onlinenotif")

@tasks.loop(minutes=1.0)
async def cRPC():
    global rpcct
    if rpcct==7:
        rpcct=0
    else:
        rpcct=rpcct+1
    await bot.change_presence(status=discord.Status.online,activity=discord.Game(name=rpcs[rpcct].format(len(bot.guilds),len(bot.users))))



async def repomsg(msg,rs):
    ch = bot.get_channel(628929788421210144)
    e =  discord.Embed(title="ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ–ãƒ­ãƒƒã‚¯å±¥æ­´",description=f"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹:{msg.clean_content}",color=bot.ec)
    e.set_author(name=f"{msg.author}(id:{msg.author.id})",icon_url=msg.author.avatar_url_as(static_format="png"))
    e.set_footer(text=f"ã‚µãƒ¼ãƒãƒ¼:{msg.guild.name}(id:{msg.guild.id})",icon_url=msg.guild.icon_url_as(static_format="png"))
    e.timestamp=msg.created_at
    e.add_field(name="ãƒ–ãƒ­ãƒƒã‚¯ç†ç”±",value=rs or "ãªã—")
    await ch.send(embed=e)
    if rs == "å…¨å“¡å½“ã¦ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³":
        bot.cursor.execute("UPDATE users SET gban = ? WHERE id = ?", (1,msg.author.id))
        bot.cursor.execute("UPDATE users SET gbanhist = ? WHERE id = ?", ("å…¨ä½“ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³é€ä¿¡æœªé‚ã§äºˆé˜²ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆBAN",msg.author.id))


async def gsended(message,ch,embed):
    try:
        tmp = await ch.send(embed=embed)

        if not message.embeds[0] == None:
            await ch.send(embed=message.embeds[0])
        return tmp.id
    except:
        pass

async def gsendwh(message,wch,spicon,pf,ed,fls):
    try:
        for wh in await wch.webhooks():
            if wh.name == "sina_global":
                if not fls==[]:
                    sdfl = []
                    for at in fls:
                        sdfl.append(discord.File(f"globalsends/{at.filename}",filename=at.filename,spoiler=at.is_spoiler()))
                    tmp = await wh.send(content=message.clean_content,wait=True,username=f"[{spicon}]{pf['gnick']}", avatar_url=message.author.avatar_url_as(static_format='png'),embeds=ed,files=sdfl)
                else:
                    tmp = await wh.send(content=message.clean_content,wait=True,username=f"[{spicon}]{pf['gnick']}", avatar_url=message.author.avatar_url_as(static_format='png'),embeds=ed)
                return tmp.id
    except:
        pass

async def globalSend(message):
    try:
        bot.cursor.execute("select * from globalchs")
        gchs = bot.cursor.fetchall()
        gchn = None
        for sgch in gchs:
            if message.channel.id in sgch["ids"]:
                gchn = sgch["name"]
                gchs = sgch["ids"]
                break
        if gchn is None:
            return
        if message.content.startswith("//"):
            return
        if message.mention_everyone:
            await repomsg(message,"å…¨å“¡å½“ã¦ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³")
            return
        if "@everyone" in message.content or "@here" in message.content:
            await repomsg(message,"å…¨å“¡å½“ã¦ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³")
            return
        if len(message.mentions) >= 5:
            await repomsg(message,"5ä»¥ä¸Šã®ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³")
            return
        if message.author.id == bot.user.id:
            return
        bot.cursor.execute("select * from users where id=?",(message.author.id,))
        upf = bot.cursor.fetchone()
        if (datetime.datetime.now() - rdelta(hours=9) - rdelta(days=7) >= message.author.created_at) or upf["gmod"] or upf["gstar"]:
            if upf["gban"] == 1:
                dc=await ut.opendm(message.author)
                await dc.send(bot._(message.author, "global-banned", message.author.mention))
                await repomsg(message,"æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆã®ä½¿ç”¨ç¦æ­¢")
                await message.add_reaction("âŒ")
                await asyncio.sleep(5)
                await message.remove_reaction("âŒ",bot.user)
            else:
                try:
                    if upf["sinapartner"] and message.author.activity:
                        if message.author.activity.type == discord.ActivityType.playing:
                            ne = discord.Embed(title="", description=f"{message.author.activity.name}ã‚’ãƒ—ãƒ¬ã‚¤ã—ã¦ã„ã¾ã™ã€‚", color=upf["gcolor"])
                        elif message.author.activity.type == discord.ActivityType.watching:
                            ne = discord.Embed(title="", description=f"{message.author.activity.name}ã‚’è¦–è´ã—ã¦ã„ã¾ã™ã€‚", color=upf["gcolor"])
                        elif message.author.activity.type == discord.ActivityType.listening:
                            if message.author.activity.name =="Spotify":
                                ne = discord.Embed(title="", description=f"Spotifyã§[{message.author.activity.title}](https://open.spotify.com/track/{message.author.activity.track_id})ã‚’èã„ã¦ã„ã¾ã™ã€‚", color=upf["gcolor"])
                            else:
                                ne = discord.Embed(title="", description=f"{message.author.activity.name}ã‚’èã„ã¦ã„ã¾ã™ã€‚", color=upf["gcolor"])
                        elif message.author.activity.type ==  discord.ActivityType.streaming:
                            ne = discord.Embed(title="", description=f"{message.author.activity.name}ã‚’é…ä¿¡ã—ã¦ã„ã¾ã™ã€‚", color=upf["gcolor"])
                        elif message.author.activity.type ==  discord.ActivityType.custom:
                            ne = discord.Embed(title="", description=f"{message.author.activity.name}", color=upf["gcolor"])
                        else:
                            ne = discord.Embed(title="", description="", color=upf["gcolor"])
                    else:
                        ne = discord.Embed(title="", description="", color=upf["gcolor"])
                    ne.set_author(name=f"{ut.ondevicon(message.author)},ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ID:{str(message.author.id)}")
                    if message.guild.id in [i[0] for i in bot.partnerg]:
                        ne.set_footer(text=f"ğŸ”—(ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚µãƒ¼ãƒãƒ¼):{message.guild.name}(id:{message.guild.id}),{[i[2] for i in bot.partnerg if i[0]==message.guild.id][0]}",icon_url=message.guild.icon_url_as(static_format="png"))
                    else:
                        ne.set_footer(text=f"{message.guild.name}(id:{message.guild.id})",icon_url=message.guild.icon_url_as(static_format="png"))
                    ne.timestamp = datetime.datetime.now() - rdelta(hours=9)
                    embed = discord.Embed(title="æœ¬æ–‡", description=message.content, color=upf["gcolor"])
                    embed.set_footer(text=f"{message.guild.name}(id:{message.guild.id})",icon_url=message.guild.icon_url_as(static_format="png"))
                    if not message.application == None:
                        embed.add_field(name=message.application["name"]+"ã¸ã®RPCæ‹›å¾…", value="RPCæ‹›å¾…ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«é€ä¿¡ã§ãã¾ã›ã‚“ã€‚")

                    spicon = ""

                    if message.author.id == 404243934210949120:  ##ã¿ãƒã¦ã‚“â˜†
                        spicon = spicon + "ğŸŒˆ"
                    if message.author.id == 539787492711464960:  ##ãã‚ƒã‚‰ã¡ã‚ƒã‚“ã•ã‚“
                        spicon = spicon + "â¤"
                    if message.author.id in bot.team_sina:  ##ãƒãƒ¼ãƒ â˜†æ€æƒŸå¥ˆã¡ã‚ƒã‚“
                        spicon = spicon + "ğŸŒ "
                    if message.author.bot:
                        spicon = spicon + "âš™"
                    if upf["sinapartner"]:
                        spicon = spicon + "ğŸ’ " ##èªè¨¼æ¸ˆã¿ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
                    if message.author.id in [i[1] for i in bot.partnerg]:
                        spicon = spicon + "ğŸ”—"
                    if upf["gmod"]:
                        spicon = spicon + "ğŸ”§"
                    if upf["galpha"]:
                        spicon = spicon + "ğŸ””"
                    if upf["gstar"]:
                        spicon = spicon + "ğŸŒŸ"
                    if spicon == "":
                        spicon = "ğŸ‘¤"

                    embed.set_author(name=f"{upf['gnick']}({spicon}):{str(message.author.id)}", icon_url=message.author.avatar_url_as(static_format="png"))
                    if not message.attachments == []:
                        embed.set_image(url=message.attachments[0].url)
                        for atc in message.attachments:
                            temp = f"{atc.url}\n"
                        embed.add_field(name="æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã®URLä¸€è¦§", value=temp)
                except:
                    traceback.print_exc(0)
                    await message.add_reaction("âŒ")
                    await asyncio.sleep(5)
                    await message.remove_reaction("âŒ",bot.user)
                    return
                try:
                    await message.add_reaction(bot.get_emoji(653161518346534912))
                except:
                    pass
            if gchn.startswith("ed-"):
                tasks=[]
                for cid in gchs:
                    ch = bot.get_channel(cid)
                    tasks.append(asyncio.ensure_future(gsended(message,ch,embed)))
                bot.cursor.execute("select * from globalchs where name=?",(gchn.replace("ed-",""),))
                nch = bot.cursor.fetchone()
                try:
                    if nch["ids"]:
                        for cid in nch["ids"]:
                            try:
                                if not cid == message.channel.id:
                                    wch = bot.get_channel(cid)
                                    tasks.append(asyncio.ensure_future(gsendwh(message,wch,spicon,upf,ne,[])))
                            except:
                                pass
                    if message.attachments == []:
                        await message.delete()
                except:
                    pass
                mids = await asyncio.gather(*tasks)
                try:
                    await message.remove_reaction(bot.get_emoji(653161518346534912),bot.user)
                except:
                    pass
            else:
                try:
                    sfs = False
                    fls = []
                    ed = []
                    if not message.attachments == []:
                        os.makedirs('globalsends/', exist_ok=True)
                        for at in message.attachments:
                            await at.save(f"globalsends/{at.filename}")
                            fls.append(at)
                        ed = ed + message.embeds + [ne]
                    else:
                        ed = ed + message.embeds + [ne]
                except:
                    traceback.print_exc(0)
                    await message.add_reaction("âŒ")
                    await asyncio.sleep(5)
                    await message.remove_reaction("âŒ",bot.user)
                    return
                try:
                    await message.add_reaction(bot.get_emoji(653161518346534912))
                except:
                    pass
                tasks = []
                for cid in gchs:
                    try:
                        if not cid == message.channel.id:
                            wch = bot.get_channel(cid)
                            tasks.append(asyncio.ensure_future(gsendwh(message,wch,spicon,upf,ed,fls)))
                    except:
                        pass
                bot.cursor.execute("select * from globalchs where name=?",(f"ed-{gchn}",))
                och = bot.cursor.fetchone()
                try:
                    if nch["ids"]:
                        for cid in och["ids"]:
                            ch = bot.get_channel(cid)
                            tasks.append(asyncio.ensure_future(gsended(message,ch,embed)))
                except:
                    pass
                mids = await asyncio.gather(*tasks)
                if not fls == []:
                    shutil.rmtree("globalsends/")
                try:
                    await message.remove_reaction(bot.get_emoji(653161518346534912),bot.user)
                except:
                    pass
            bot.cursor.execute("INSERT INTO globaldates(id,content,allid,aid,gid,timestamp) VALUES(?,?,?,?,?,?)", (int(time.time())+random.randint(1,30),message.clean_content,mids+[message.id],message.author.id,message.guild.id,str(message.created_at.strftime('%Y{0}%m{1}%d{2} %H{3}%M{4}%S{5}').format(*'å¹´æœˆæ—¥æ™‚åˆ†ç§’'))))
            await message.add_reaction(bot.get_emoji(653161518195539975))
            await asyncio.sleep(5)
            await message.remove_reaction(bot.get_emoji(653161518195539975),bot.user)
        else:
            await repomsg(message,"ä½œæˆå¾Œ7æ—¥ã«æº€ãŸãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ")
    except Exception as e:
        traceback.print_exc()

@bot.event
async def on_member_update(b,a):
    global Donotif
    #serverlog
    try:
        e=discord.Embed(title="ãƒ¡ãƒ³ãƒãƒ¼ã®æ›´æ–°",description=f"å¤‰æ›´ãƒ¡ãƒ³ãƒãƒ¼:{str(a)}",color=bot.ec)
        e.timestamp = datetime.datetime.now() - rdelta(hours=9)
        if not b.nick == a.nick:
            e.add_field(name="å¤‰æ›´å†…å®¹",value="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ")
            if b.nick:
                bnick = b.nick
            else:
                bnick = b.name
            if a.nick:
                anick = a.nick
            else:
                anick = a.name
            e.add_field(name="å¤‰æ›´å‰",value=bnick.replace("\\","\\\\").replace("*","\*").replace("_","\_").replace("|","\|").replace("~","\~").replace("`","\`").replace(">","\>"))
            e.add_field(name="å¤‰æ›´å¾Œ",value=anick.replace("\\","\\\\").replace("*","\*").replace("_","\_").replace("|","\|").replace("~","\~").replace("`","\`").replace(">","\>"))
            bot.cursor.execute("select * from guilds where id=?",(a.guild.id,))
            gpf = bot.cursor.fetchone()
            if gpf["sendlog"]:
                ch = bot.get_channel(gpf["sendlog"])
                if ch.guild.id == a.guild.id:
                    await ch.send(embed=e)
        elif not b.roles == a.roles:
            if len(b.roles) > len(a.roles):
                e.add_field(name="å¤‰æ›´å†…å®¹",value="å½¹è·é™¤å»")
                e.add_field(name="å½¹è·",value=list(set(b.roles)-set(a.roles))[0])
            else:
                e.add_field(name="å¤‰æ›´å†…å®¹",value="å½¹è·ä»˜ä¸")
                e.add_field(name="å½¹è·",value=list(set(a.roles)-set(b.roles))[0])
            bot.cursor.execute("select * from guilds where id=?",(a.guild.id,))
            gpf = bot.cursor.fetchone()
            if gpf["sendlog"]:
                ch = bot.get_channel(gpf["sendlog"])
                if ch.guild.id == a.guild.id:
                    await ch.send(embed=e)
    except:
        pass
    # online notif are now handled in apple_onlinenotif

async def nga(m,r):
    ch=m.guild.get_channel(631875590307446814)

    admins = m.guild.get_role(574494236951707668)
    tmpadmins = m.guild.get_role(583952666317684756)
    subadmins = m.guild.get_role(579283058394660864)
    giverole = m.guild.get_role(620911942889897984)
    tch = await ch.create_text_channel(f"èªè¨¼å¾…ã¡-{m.name}",overwrites={
        m:discord.PermissionOverwrite(read_messages=True,send_messages=True),
        m.guild.default_role:discord.PermissionOverwrite(read_messages=False),
        admins:discord.PermissionOverwrite(read_messages=True,send_messages=True),
        tmpadmins:discord.PermissionOverwrite(read_messages=True,send_messages=True),
        subadmins:discord.PermissionOverwrite(read_messages=True,send_messages=True),
        giverole:discord.PermissionOverwrite(read_messages=True,send_messages=True)
    },topic=str(m.id))
    await tch.send(f"""{m.mention}ã•ã‚“ï¼ã¿ãƒã¦ã‚“â˜†ã®ã‚ã„ãŒã‚„åºƒå ´ã«ã‚ˆã†ã“ãï¼
ã‚ãªãŸã¯{r}ãŒç†ç”±ã§ã€æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã«ã‚ˆã‚‹è‡ªå‹•èªè¨¼ãŒè¡Œã‚ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚
æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã«é–¢ã™ã‚‹ãŠå•ã„åˆã‚ã›ç­‰ã®æ–¹ã¯`æ€æƒŸå¥ˆã¡ã‚ƒã‚“`ã‚«ãƒ†ã‚´ãƒªãƒ¼å†…ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚
ä¸æ˜ç‚¹ç­‰ã”ã–ã„ã¾ã—ãŸã‚‰ã€ã“ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚

ãã®ä»–ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ä½¿ã†éš›ã«ã¯ã€ãƒ¡ãƒ³ãƒãƒ¼å½¹è·ãŒå¿…è¦ã§ã™ã€‚
ã¾ãšã¯ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„!
<#574500456471199746> ã“ã®ãƒãƒ£ãƒ³ãƒãƒ«ã«ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚
ãã®å¾Œã€ãã®ã“ã¨ã‚’å ±å‘Šã—ã¦ãã ã•ã„ã€‚
ã¿ãƒã¦ã‚“â˜†
    """)

@bot.event
async def on_member_join(member):
    if member.guild.id == 574170788165582849:
        if member.bot:
            await member.add_roles(member.guild.get_role(574494559946539009))
        else:
            uich = bot.get_channel(633651383353999370)

            e= discord.Embed(title=f"å‚åŠ ãƒ¡ãƒ³ãƒãƒ¼{member}ã«ã¤ã„ã¦",color=bot.ec)
            e.add_field(name="å…±é€šã‚µãƒ¼ãƒãƒ¼æ•°",value=len([g for g in bot.guilds if g.get_member(member.id)]))
            e.add_field(name="ID",value=member.id)
            e.set_footer(text="ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—")
            e.timestamp=member.created_at
            await uich.send(embed=e)
            mrole = member.guild.get_role(574494088837988352)

            bunotif = 0
            if len([g for g in bot.guilds if g.get_member(member.id)]) == 1:
                await nga(member,"æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã¨ã®å…±é€šã®ã‚µãƒ¼ãƒãƒ¼ãŒã»ã‹ã«ãªã„ã“ã¨")
            else:
                for g in bot.guilds:

                    try:
                        tmp = await g.bans()
                    except:
                        continue
                    banulist = [i.user.id for i in tmp]
                    if member.id in banulist:
                        bunotif = bunotif + 1
                if bunotif != 0:
                    await nga(member,"æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã¨ã®å…±é€šã®ã»ã‹ã‚µãƒ¼ãƒãƒ¼ã§ã®ban")
                    pass
                else:
                    if datetime.datetime.now() - rdelta(hours=9) - rdelta(days=4) < member.created_at:
                        await nga(member,"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆã‹ã‚‰4æ—¥çµŒéã—ã¦ã„ãªã„ã“ã¨")
                        pass
                    else:
                        await nga(member,"æœ¬æ¥èªè¨¼ã—ã¦ã„ã¾ã™ãŒã€ç¾åœ¨ã¯èªè¨¼æ­¢ã‚ã¦ã„ã‚‹ã“ã¨")
                        '''await member.add_roles(mrole)
                        ch = await ut.opendm(member)
                        try:
                            await ch.send(f"""{member.mention}ã•ã‚“ï¼ã¿ãƒã¦ã‚“â˜†ã®ã‚ã„ãŒã‚„åºƒå ´ã«ã‚ˆã†ã“ãï¼
    æ€æƒŸå¥ˆã¡ã‚ƒã‚“é–¢é€£ã®ç”¨äº‹ã®æ–¹ã¯`æ€æƒŸå¥ˆã¡ã‚ƒã‚“`ã‚«ãƒ†ã‚´ãƒªãƒ¼å†…ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚
    ã¾ãŸã€ã‚ãªãŸã¯ã€ã„ãã¤ã‹ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ãŸã‚ã€è‡ªå‹•çš„ã«ãƒ¡ãƒ³ãƒãƒ¼å½¹è·ãŒä»˜ä¸ã•ã‚Œã¾ã—ãŸã®ã§ã€ã‚µãƒ¼ãƒãƒ¼ã§ã€ã‚†ã£ãã‚Šéã”ã•ã‚Œã¦ãã ã•ã„ã€‚
    ã§ã™ãŒã€ä½¿ç”¨å‰ã«ã¾ãšã¯ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„!
    https://gist.github.com/apple502j/1a81b1a95253609f0c67ecb74f38754b
    ã¾ãŸã€å¿…è¦ã«å¿œã˜ã¦é€šçŸ¥è¨­å®šã‚’ã€Œã™ã¹ã¦ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ãªã©ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€Œ@ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã®ã¿ã€ã§ã™ã€‚)
                            """)
                        except:
                            ch = member.guild.get_channel(574494906287128577)
                            await ch.send(f"""{member.mention}ã•ã‚“ï¼ã¿ãƒã¦ã‚“â˜†ã®ã‚ã„ãŒã‚„åºƒå ´ã«ã‚ˆã†ã“ãï¼
    æ€æƒŸå¥ˆã¡ã‚ƒã‚“é–¢é€£ã®ç”¨äº‹ã®æ–¹ã¯`æ€æƒŸå¥ˆã¡ã‚ƒã‚“`ã‚«ãƒ†ã‚´ãƒªãƒ¼å†…ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚
    ã¾ãŸã€ã‚ãªãŸã¯ã€ã„ãã¤ã‹ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ãŸã‚ã€è‡ªå‹•çš„ã«ãƒ¡ãƒ³ãƒãƒ¼å½¹è·ãŒä»˜ä¸ã•ã‚Œã¾ã—ãŸã®ã§ã€ã‚µãƒ¼ãƒãƒ¼ã§ã€ã‚†ã£ãã‚Šéã”ã•ã‚Œã¦ãã ã•ã„ã€‚
    ã§ã™ãŒã€ä½¿ç”¨å‰ã«ã¾ãšã¯ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„!
    https://gist.github.com/apple502j/1a81b1a95253609f0c67ecb74f38754b
    ã¾ãŸã€å¿…è¦ã«å¿œã˜ã¦é€šçŸ¥è¨­å®šã‚’ã€Œã™ã¹ã¦ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ãªã©ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€Œ@ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã®ã¿ã€ã§ã™ã€‚)
                            """)
                        schs=[631815290044284938,574494906287128577]
                        for c in schs:

                            sch = bot.get_channel(c)
                            await sch.send(embed=ut.getEmbed("è‡ªå‹•èªè¨¼å®Œäº†ã®ãŠçŸ¥ã‚‰ã›",f"{member.mention}ã•ã‚“ãŒè‡ªå‹•èªè¨¼ã‚’æ¸ˆã¾ã›ã¾ã—ãŸã€‚"))'''
    else:
        try:
            bot.cursor.execute("select * from guilds where id=?",(member.guild.id,))
            gpf = bot.cursor.fetchone()
            ctt = gpf["jltasks"]
            if not ctt.get("welcome") == None:
                if ctt["welcome"]["sendto"] == "sysch":
                    await member.guild.system_channel.send(ctt["welcome"]["content"].format(member.mention))
                else:
                    dc = await ut.opendm(member)
                    await dc.send(ctt["welcome"]["content"].format(member.mention))
        except:
            pass
    e=discord.Embed(title="ãƒ¡ãƒ³ãƒãƒ¼ã®å‚åŠ ",description=f"{len(member.guild.members)}äººç›®ã®ãƒ¡ãƒ³ãƒãƒ¼",color=bot.ec)
    e.add_field(name="å‚åŠ ãƒ¡ãƒ³ãƒãƒ¼",value=member.mention)
    e.add_field(name="ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®id",value=member.id)
    e.set_footer(text=f"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ—¥æ™‚(ãã®ã¾ã¾ã®å€¤:{(member.created_at + rdelta(hours=9)).strftime('%Y{0}%m{1}%d{2} %H{3}%M{4}%S{5}').format(*'å¹´æœˆæ—¥æ™‚åˆ†ç§’')},ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—åŒ–:")
    e.timestamp = member.created_at
    bot.cursor.execute("select * from guilds where id=?",(member.guild.id,))
    gpf = bot.cursor.fetchone()
    try:
        if gpf["sendlog"]:
            ch = bot.get_channel(gpf["sendlog"])
            if ch.guild.id == member.guild.id:
                await ch.send(embed=e)
    except:
        pass
    #ä»–ã‚µãƒ¼ãƒãƒ¼ã§ã®bané€šçŸ¥
    isgban = False
    bot.cursor.execute("select * from users where id=?",(member.id,))
    upf = bot.cursor.fetchone()
    bunotif = 0
    if member.id in bot.team_sina:
        for ch in member.guild.channels:
            if ch.name == "sina-user-check":
                await ch.send(embed=discord.Embed(title=f"{member}ã®å®‰å…¨æ€§è©•ä¾¡",description=f"ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ãƒãƒ¼ãƒ â˜†æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã®ãƒ¡ãƒ³ãƒãƒ¼ã§ã™ã€‚"))
    elif upf and upf["gban"] == 1:
        for ch in member.guild.channels:
            if ch.name == "sina-user-check":
                await ch.send(embed=discord.Embed(title=f"{member}ã®å®‰å…¨æ€§è©•ä¾¡",description=f"ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆbanã‚’å—ã‘ã¦ã„ã¾ã™ã€‚\nä½•ã‚‰ã‹ã®äº‹æƒ…ãŒã‚ã£ã¦ã“ã†ãªã£ã¦ã„ã¾ã™ã®ã§ååˆ†ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚"))
    else:
        for g in bot.guilds:

            try:
                tmp = await g.bans()
            except:
                continue
            banulist = [i.user.id for i in tmp]
            if member.id in banulist:
                bunotif = bunotif + 1
        if bunotif == 0:
            for ch in member.guild.channels:
                if ch.name == "sina-user-check":
                    await ch.send(embed=discord.Embed(title=f"{member}ã®å®‰å…¨æ€§è©•ä¾¡",description=f"ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã®ã„ã‚‹ã‚µãƒ¼ãƒãƒ¼ã§ã¯ã€banã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"))
        else:
            for ch in member.guild.channels:
                if ch.name == "sina-user-check":
                    await ch.send(embed=discord.Embed(title=f"{member}ã®å®‰å…¨æ€§è©•ä¾¡",description=f"ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã®ã„ã‚‹{bunotif}ã®ã‚µãƒ¼ãƒãƒ¼ã§banã•ã‚Œã¦ã„ã¾ã™ã€‚æ³¨æ„ã—ã¦ãã ã•ã„ã€‚"))


@bot.event
async def on_member_remove(member):
    if member.guild.id == 574170788165582849:
        await member.guild.system_channel.send(f"{str(member)}ã•ã‚“ãŒã“ã®ã‚µãƒ¼ãƒãƒ¼ã‚’é€€å‡ºã—ã¾ã—ãŸã€‚")
    else:
        try:
            bot.cursor.execute("select * from guilds where id=?",(member.guild.id,))
            gpf = bot.cursor.fetchone()
            ctt = gpf["jltasks"]
            if not ctt.get("cu") == None:
                if ctt["cu"]["sendto"] == "sysch":
                    await member.guild.system_channel.send(ctt["cu"]["content"].format(str(member)))
                else:
                    dc = await ut.opendm(member)
                    await dc.send(ctt["cu"]["content"].format(str(member)))
        except:
            pass
    e=discord.Embed(title="ãƒ¡ãƒ³ãƒãƒ¼ã®é€€å‡º",color=bot.ec)
    e.add_field(name="é€€å‡ºãƒ¡ãƒ³ãƒãƒ¼",value=str(member))
    e.add_field(name="å½¹è·",value=[i.name for i in member.roles])
    #e.set_footer(text=f"{member.guild.name}/{member.guild.id}")
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    bot.cursor.execute("select * from guilds where id=?",(member.guild.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == member.guild.id:
            await ch.send(embed=e)
    """if member.guild.id == 611445741902364672:
        c = bot.get_channel(613629308166209549)
        await c.send(embed=e)"""

@bot.event
async def on_webhooks_update(channel):
    e=discord.Embed(title="Webhooksã®æ›´æ–°",color=bot.ec)
    e.add_field(name="ãƒãƒ£ãƒ³ãƒãƒ«",value=channel.mention)
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    bot.cursor.execute("select * from guilds where id=?",(channel.guild.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == channel.guild.id:
            await ch.send(embed=e)

@bot.event
async def on_guild_role_create(role):
    e=discord.Embed(title="å½¹è·ã®ä½œæˆ",color=bot.ec)
    e.add_field(name="å½¹è·å",value=role.name)
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    bot.cursor.execute("select * from guilds where id=?",(role.guild.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == role.guild.id:
            await ch.send(embed=e)

@bot.event
async def on_guild_role_delete(role):
    e=discord.Embed(title="å½¹è·ã®å‰Šé™¤",color=bot.ec)
    e.add_field(name="å½¹è·å",value=role.name)
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    bot.cursor.execute("select * from guilds where id=?",(role.guild.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == role.guild.id:
            await ch.send(embed=e)

@bot.event
async def on_message_edit(before, after):
    if after.channel.id == 611117238464020490:
        if after.embeds and before.content==after.content:
            bot.cursor.execute("select * from globalchs where name=?",("é˜²ç½æƒ…å ±",))
            chs = bot.cursor.fetchone()
            es = after.embeds
            sed=[]
            for e in es:
                e.color = bot.ec
                e.title = f'ğŸ’ {str(e.title).replace("Embed.Empty","é˜²ç½æƒ…å ±")}'
                sed.append(e)
            for chid in chs["ids"]:
                try:
                    ch = bot.get_channel(chid)
                    for wh in await ch.webhooks():
                        try:
                            if wh.name == "sina_global":
                                await wh.send(embeds=sed)
                                await asyncio.sleep(0.2)
                                break
                        except:
                            continue
                except:
                    pass
    if not after.author.bot:
        if before.content != after.content:
            e=discord.Embed(title="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç·¨é›†",color=bot.ec)
            e.add_field(name="ç·¨é›†å‰",value=before.content)
            e.add_field(name="ç·¨é›†å¾Œ",value=after.content)
            e.add_field(name="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡è€…",value=after.author.mention)
            e.add_field(name="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ£ãƒ³ãƒãƒ«",value=after.channel.mention)
            e.add_field(name="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®URL",value=after.jump_url)
            e.timestamp = datetime.datetime.now() - rdelta(hours=9)
            bot.cursor.execute("select * from guilds where id=?",(after.guild.id,))
            gpf = bot.cursor.fetchone()
            if gpf["sendlog"]:
                ch = bot.get_channel(gpf["sendlog"])
                if ch.guild.id == after.guild.id:
                    await ch.send(embed=e)

@bot.event
async def on_guild_channel_delete(channel):
    bl=await channel.guild.audit_logs(limit=1,action=discord.AuditLogAction.channel_delete).flatten()
    e=discord.Embed(title="ãƒãƒ£ãƒ³ãƒãƒ«å‰Šé™¤",color=bot.ec)
    e.add_field(name="ãƒãƒ£ãƒ³ãƒãƒ«å",value=channel.name)
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    bot.cursor.execute("select * from guilds where id=?",(channel.guild.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == channel.guild.id:
            await ch.send(embed=e)

@bot.event
async def on_reaction_clear(message, reactions):
    e=discord.Embed(title="ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸€æ–‰é™¤å»",color=bot.ec)
    e.add_field(name="ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³",value=[str(i) for i in reactions])
    e.add_field(name="é™¤å»ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",value=message.content or "(æœ¬æ–‡ãªã—)")
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    bot.cursor.execute("select * from guilds where id=?",(message.guild.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == message.guild.id:
            await ch.send(embed=e)

@bot.event
async def on_message_delete(message):
    if not message.author.bot:
        e=discord.Embed(title="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤",color=bot.ec)
        e.add_field(name="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",value=message.content)
        e.add_field(name="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡è€…",value=message.author.mention)
        e.add_field(name="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ£ãƒ³ãƒãƒ«",value=message.channel.mention)
        e.add_field(name="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®id",value=message.id)
        e.timestamp = datetime.datetime.now() - rdelta(hours=9)
        bot.cursor.execute("select * from guilds where id=?",(message.guild.id,))
        gpf = bot.cursor.fetchone()
        if gpf["sendlog"]:
            ch = bot.get_channel(gpf["sendlog"])
            if ch.guild.id == message.guild.id:
                await ch.send(embed=e)


@bot.event
async def on_bulk_message_delete(messages):
    e=discord.Embed(title="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€æ‹¬å‰Šé™¤",color=bot.ec)
    e.add_field(name="ä»¶æ•°",value=len(messages))
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    for message in messages:
        if not message.author.bot:
            e.add_field(name="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",value=message.content)
            e.add_field(name="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡è€…",value=message.author.mention)
            e.add_field(name="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®id",value=message.id)
    bot.cursor.execute("select * from guilds where id=?",(messages[0].guild.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == messages[0].guild.id:
            await ch.send(embed=e)


@bot.event
async def on_guild_channel_create(channel):
    e=discord.Embed(title="ãƒãƒ£ãƒ³ãƒãƒ«ä½œæˆ",color=bot.ec)
    e.add_field(name="ãƒãƒ£ãƒ³ãƒãƒ«å",value=channel.mention)
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    bot.cursor.execute("select * from guilds where id=?",(channel.guild.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == channel.guild.id:
            await ch.send(embed=e)

@bot.event
async def on_guild_channel_update(b, a):
    e=discord.Embed(title="ãƒãƒ£ãƒ³ãƒãƒ«æ›´æ–°",description=a.mention,color=bot.ec)
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    if not b.name == a.name:
        if not a.guild.id == 461789442743468073:
            e.add_field(name="å¤‰æ›´å†…å®¹",value="ãƒãƒ£ãƒ³ãƒãƒ«å")
            e.add_field(name="å¤‰æ›´å‰",value=b.name)
            e.add_field(name="å¤‰æ›´å¾Œ",value=a.name)
            bot.cursor.execute("select * from guilds where id=?",(a.guild.id,))
            gpf = bot.cursor.fetchone()
            if gpf["sendlog"]:
                ch = bot.get_channel(gpf["sendlog"])
                if ch.guild.id == a.guild.id:
                    await ch.send(embed=e)
    elif not b.changed_roles == a.changed_roles:
        e.add_field(name="å¤‰æ›´å†…å®¹",value="æ¨©é™ã®ä¸Šæ›¸ã")
        e.add_field(name="ç¢ºèª:",value="ãƒãƒ£ãƒ³ãƒãƒ«è¨­å®šã‚’è¦‹ã¦ãã ã•ã„ã€‚")
        bot.cursor.execute("select * from guilds where id=?",(a.guild.id,))
        gpf = bot.cursor.fetchone()
        if gpf["sendlog"]:
            ch = bot.get_channel(gpf["sendlog"])
            if ch.guild.id == a.guild.id:
                await ch.send(embed=e)
    elif isinstance(b,discord.TextChannel):
        if not b.topic == a.topic:
            e.add_field(name="å¤‰æ›´å†…å®¹",value="ãƒãƒ£ãƒ³ãƒãƒ«ãƒˆãƒ”ãƒƒã‚¯")
            e.add_field(name="å¤‰æ›´å‰",value=b.topic)
            e.add_field(name="å¤‰æ›´å¾Œ",value=a.topic)
            bot.cursor.execute("select * from guilds where id=?",(a.guild.id,))
            gpf = bot.cursor.fetchone()
            if gpf["sendlog"]:
                ch = bot.get_channel(gpf["sendlog"])
                if ch.guild.id == a.guild.id:
                    await ch.send(embed=e)

@bot.event
async def on_guild_update(b, a):
    e=discord.Embed(title="ã‚µãƒ¼ãƒãƒ¼ã®æ›´æ–°",color=bot.ec)
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    if b.name != a.name:
        e.add_field(name="å¤‰æ›´å†…å®¹",value="ã‚µãƒ¼ãƒãƒ¼å")
        e.add_field(name="å¤‰æ›´å‰",value=b.name)
        e.add_field(name="å¤‰æ›´å¾Œ",value=a.name)
        bot.cursor.execute("select * from guilds where id=?",(a.id,))
        gpf = bot.cursor.fetchone()
        if gpf["sendlog"]:
            ch = bot.get_channel(gpf["sendlog"])
            if ch.guild.id == a.id:
                await ch.send(embed=e)
    elif b.icon != a.icon:
        e.add_field(name="å¤‰æ›´å†…å®¹",value="ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³")
        bot.cursor.execute("select * from guilds where id=?",(a.id,))
        gpf = bot.cursor.fetchone()
        if gpf["sendlog"]:
            ch = bot.get_channel(gpf["sendlog"])
            if ch.guild.id == a.id:
                await ch.send(embed=e)
    elif b.owner.id != a.owner.id:
        e.add_field(name="å¤‰æ›´å†…å®¹",value="ã‚µãƒ¼ãƒãƒ¼æ‰€æœ‰è€…ã®å¤‰æ›´")
        e.add_field(name="å¤‰æ›´å‰",value=b.owner)
        e.add_field(name="å¤‰æ›´å¾Œ",value=a.owner)
        bot.cursor.execute("select * from guilds where id=?",(a.id,))
        gpf = bot.cursor.fetchone()
        if gpf["sendlog"]:
            ch = bot.get_channel(gpf["sendlog"])
            if ch.guild.id == a.id:
                await ch.send(embed=e)

@bot.event
async def on_member_ban(g, user):
    guild = bot.get_guild(g.id)
    bl=await guild.audit_logs(limit=1,action=discord.AuditLogAction.ban).flatten()
    e=discord.Embed(title="ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ban",color=bot.ec)
    e.add_field(name="ãƒ¦ãƒ¼ã‚¶ãƒ¼å",value=str(user))
    e.add_field(name="å®Ÿè¡Œè€…",value=str(bl[0].user))
    #e.set_footer(text=f"{g.name}/{g.id}")
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    bot.cursor.execute("select * from guilds where id=?",(g.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == g.id:
            await ch.send(embed=e)

@bot.event
async def on_member_unban(guild, user):
    e=discord.Embed(title="ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®banè§£é™¤",color=bot.ec)
    e.add_field(name="ãƒ¦ãƒ¼ã‚¶ãƒ¼å",value=str(user))
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    bot.cursor.execute("select * from guilds where id=?",(guild.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == guild.id:
            await ch.send(embed=e)

@bot.event
async def on_guild_join(guild):
    e=discord.Embed(title=f"æ€æƒŸå¥ˆã¡ã‚ƒã‚“ãŒ{guild.name}ã«å‚åŠ ã—ãŸã‚ˆï¼",description=f"id:{guild.id}",color=bot.ec)
    e.add_field(name="ã‚µãƒ¼ãƒãƒ¼ä½œæˆæ—¥æ™‚",value=f"{(guild.created_at+ rdelta(hours=9)).strftime('%Y{0}%m{1}%d{2} %H{3}%M{4}%S{5}').format(*'å¹´æœˆæ—¥æ™‚åˆ†ç§’')}")
    e.add_field(name="ãƒ¡ãƒ³ãƒãƒ¼æ•°",value=f"{len([i for i in guild.members if not i.bot])}ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€{len([i for i in guild.members if i.bot])}bot")
    e.add_field(name="ãƒãƒ£ãƒ³ãƒãƒ«æ•°",value=f"ãƒ†ã‚­ã‚¹ãƒˆ:{len(guild.text_channels)}\nãƒœã‚¤ã‚¹:{len(guild.voice_channels)}\nã‚«ãƒ†ã‚´ãƒªãƒ¼{len(guild.categories)}")
    ch = bot.get_channel(693048937304555529)
    await ch.send(embed=e)

@bot.event
async def on_guild_remove(guild):
    ch = bot.get_channel(693048937304555529)
    await ch.send(f"`{guild.name}`(id:{guild.id})ã‹ã‚‰é€€å‡ºã—ã¾ã—ãŸã€‚")

@bot.event
async def on_invite_create(invite):
    e=discord.Embed(title="ã‚µãƒ¼ãƒãƒ¼æ‹›å¾…ã®ä½œæˆ",color=bot.ec)
    e.add_field(name="ä½œæˆãƒ¦ãƒ¼ã‚¶ãƒ¼",value=str(invite.inviter))
    e.add_field(name="ä½¿ç”¨å¯èƒ½å›æ•°",value=str(invite.max_uses))
    e.add_field(name="ä½¿ç”¨å¯èƒ½æ™‚é–“",value=str(invite.max_age))
    e.add_field(name="ãƒãƒ£ãƒ³ãƒãƒ«",value=str(invite.channel.mention))
    e.add_field(name="ã‚³ãƒ¼ãƒ‰",value=str(invite.code))
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    bot.cursor.execute("select * from guilds where id=?",(invite.guild.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == invite.guild.id:
            await ch.send(embed=e)


@bot.event
async def on_invite_delete(invite):
    e=discord.Embed(title="ã‚µãƒ¼ãƒãƒ¼æ‹›å¾…ã®å‰Šé™¤",color=bot.ec)
    e.add_field(name="ä½œæˆãƒ¦ãƒ¼ã‚¶ãƒ¼",value=str(invite.inviter))
    e.add_field(name="ãƒãƒ£ãƒ³ãƒãƒ«",value=str(invite.channel.mention))
    e.add_field(name="ã‚³ãƒ¼ãƒ‰",value=str(invite.code))
    e.timestamp = datetime.datetime.now() - rdelta(hours=9)
    bot.cursor.execute("select * from guilds where id=?",(invite.guild.id,))
    gpf = bot.cursor.fetchone()
    if gpf["sendlog"]:
        ch = bot.get_channel(gpf["sendlog"])
        if ch.guild.id == invite.guild.id:
            await ch.send(embed=e)

@bot.event
async def on_ready():
    global aglch
    print('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸã€‚')
    print(bot.user.name)
    print(bot.user.id)
    print('------------------')
    aglch = bot.get_channel(659706303521751072)
    pmsgc=bot.get_channel(676371380111015946)
    cRPC.start()
    """invite_tweet.start()
    now_sina_tweet.start()"""
    bot.load_extension("jishaku")
    m10s_music.setup(bot)
    m10s_info.setup(bot)
    m10s_owner.setup(bot)
    m10s_settings.setup(bot)
    m10s_manage.setup(bot)
    m10s_levels.setup(bot)
    m10s_tests.setup(bot)
    m10s_gcoms.setup(bot)
    m10s_search.setup(bot)
    m10s_other.setup(bot)
    m10s_games.setup(bot)
    P143_jyanken.setup(bot)
    nekok500_mee6.setup(bot)
    syouma.setup(bot)
    pf9_symmetry.setup(bot)
    m10s_gban.setup(bot)
    m10s_bmail.setup(bot)
    m10s_auth_wiz.setup(bot)
    try:
        ch = bot.get_channel(595526013031546890)
        await ch.send(f"{bot.get_emoji(653161518531215390)}on_ready!")
    except:
        pass

@bot.event
async def on_message(message):
    if "cu:on_msg" in bot.features.get(message.author.id,[]):
        return
    if isinstance(message.channel,discord.DMChannel):
        return
    if message.webhook_id:
        return
    if message.author.id==bot.user.id:
        return
    if postcount.get(str(message.guild.id),None) is None:
        postcount[str(message.guild.id)] = 1
    else:
        postcount[str(message.guild.id)] += 1
    #db.files_download_to_file( "guildsetting.json" , "/guildsetting.json" )
    #db.files_download_to_file( "profiles.json" , "/profiles.json" )
    tks=[
        domsg(message),
        globalSend(message),
    ]
    await asyncio.gather(*tks)
    #await domsg(message)
    #await globalSend(message)


async def domsg(message):
    global DoServercmd
    bot.cursor.execute("select * from users where id=?",(message.author.id,))
    pf = bot.cursor.fetchone()
    if not pf:
        bot.cursor.execute("INSERT INTO users(id,prefix,gpoint,memo,levcard,onnotif,lang,accounts,sinapartner,gban,gnick,gcolor,gmod,gstar,galpha,gbanhist) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)", (message.author.id,[],0,{},"m@jiâ˜†",[],"ja",[],0,0,message.author.name,0,0,0,0,"ãªã—"))
        try:
            dc=await ut.opendm(message.author)
            await dc.send(f"{bot.get_emoji(653161518153596950)}ã‚ãªãŸã®æ€æƒŸå¥ˆã¡ã‚ƒã‚“ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸï¼ã„ãã¤ã‹ã®é …ç›®ã¯ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦æ›¸ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è©³ã—ãã¯ãƒ˜ãƒ«ãƒ—(`s-help`)ã‚’ã”è¦§ãã ã•ã„ã€‚\nã¾ãŸã€ä¸å…·åˆã‚„ç–‘å•ç‚¹ãªã©ãŒã‚ã‚Šã¾ã—ãŸã‚‰`mii-10#3110`ã«ãŠé¡˜ã„ã—ã¾ã™ã€‚")
        except:
            pass
        bot.cursor.execute("select * from users where id=?",(message.author.id,))
        pf = bot.cursor.fetchone()

    bot.cursor.execute("select * from guilds where id=?",(message.guild.id,))
    gs = bot.cursor.fetchone()
    if not gs:
        guild_lang = bot.translate_handler.get_lang_by_guild(message.guild, False)
        bot.cursor.execute("INSERT INTO guilds(id,levels,commands,hash,levelupsendto,reward,jltasks,lockcom,sendlog,prefix,lang) VALUES(?,?,?,?,?,?,?,?,?,?,?)", (message.guild.id,{},{},[],None,{},{},[],None,[],guild_lang))
        try:
            await message.channel.send(f"{bot.get_emoji(653161518153596950)}ã“ã®ã‚µãƒ¼ãƒãƒ¼ã®æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸï¼ã„ãã¤ã‹ã®é …ç›®ã¯ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦æ›¸ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è©³ã—ãã¯ãƒ˜ãƒ«ãƒ—(`s-help`)ã‚’ã”è¦§ãã ã•ã„ã€‚\nã¾ãŸã€ä¸å…·åˆã‚„ç–‘å•ç‚¹ãªã©ãŒã‚ã‚Šã¾ã—ãŸã‚‰`mii-10#3110`ã«ãŠé¡˜ã„ã—ã¾ã™ã€‚\næ€æƒŸå¥ˆã¡ã‚ƒã‚“ã®ãŠçŸ¥ã‚‰ã›ã¯`s-rnotify [ãƒãƒ£ãƒ³ãƒãƒ«id(çœç•¥å¯èƒ½)]`ã§ã€ã‚³ãƒãƒ³ãƒ‰ç­‰ã®è±†çŸ¥è­˜ã¯`s-rtopic [ãƒãƒ£ãƒ³ãƒãƒ«id(çœç•¥å¯èƒ½)]`ã§å—ä¿¡ã™ã‚‹è¨­å®šã«ã§ãã¾ã™ã€‚(Webhookç®¡ç†æ¨©é™ãŒå¿…è¦ã§ã™ã€‚)")
        except:
            pass
        bot.cursor.execute("select * from guilds where id=?",(message.guild.id,))
        gs = bot.cursor.fetchone()

    tks=[asyncio.ensure_future(dlevel(message,gs)),asyncio.ensure_future(gahash(message,gs)),asyncio.ensure_future(runsercmd(message,gs,pf))]
    await asyncio.gather(*tks)

    tpf=["s-"]+pf["prefix"]+gs["prefix"]
    bot.command_prefix = tpf
    ctx = await bot.get_context(message)
    try:
        if ctx.command:
            if ctx.command.name in gs["lockcom"] and not ctx.author.guild_permissions.administrator and ctx.author.id != 404243934210949120:
                await ctx.send(ctx._("comlock-locked"))
            else:
                await bot.process_commands(message)
    except SystemExit:
        sys.exit()
    except Exception:
        print(traceback.format_exc(0))


async def runsercmd(message,gs,pf):
    #servercmd
    if not "scom" in gs["lockcom"]:
        if not message.author.id == bot.user.id and message.webhook_id is None:
            tpf=pf["prefix"]+gs["prefix"]
            tpf.append("s-")
            try:
                if not gs["commands"] == None:
                    cmds = gs["commands"]
                    ctts = message.content.split(" ")
                    for k,v in cmds.items():
                        for px in tpf:
                            if px+k == ctts[0]:
                                DoServercmd = True
                                if v["mode"] == "random":
                                    await message.channel.send(random.choice(v["rep"]))
                                elif v["mode"] == "one":
                                    await message.channel.send(v["rep"])
                                elif v["mode"] == "role":
                                    try:
                                        role =message.guild.get_role(v["rep"])
                                    except:
                                        await message.channel.send(bot._(message.author,"scmd-notfound-role"))
                                    if role < message.author.top_role:
                                        if role in message.author.roles:
                                            await message.author.remove_roles(role)
                                            await message.channel.send(bot._(message.author, "scmd-delrole"))
                                        else:
                                            await message.author.add_roles(role)
                                            await message.channel.send(bot._(message.author, "scmd-addrole"))
                                    else:
                                        await message.channel.send(bot._(message.author,"scmd-notrole"))
                                break
            except:
                pass

async def gahash(message,gs):
    #hash
    if "s-noHashSend" in (message.channel.topic or ""):
        return
    if not "hash" in gs["lockcom"]:
        ch=gs["hash"]
        if not ch is []:
            menchan = message.channel_mentions
            for sch in menchan:
                if sch.id in ch:
                    if message.channel.is_nsfw():
                        embed = discord.Embed(title="", description=bot.l10n_guild(message.guild,"hash-nsfw"),color=message.author.color)
                        embed.add_field(name=bot.l10n_guild(message.guild,"hash-from"),value=f'{bot.l10n_guild(message.guild,"hash-chmention")}:{message.channel.mention}\n{bot.l10n_guild(message.guild,"hash-chname")}:{message.channel.name}')
                        embed.add_field(name=bot.l10n_guild(message.guild,"hash-link"),value=message.jump_url)
                        embed.set_author(name=message.author.display_name, icon_url=message.author.avatar_url_as(static_format='png'))
                    else:
                        embed = discord.Embed(title="", description=message.content, color=message.author.color)
                        embed.add_field(name=bot.l10n_guild(message.guild,"hash-from"),value=f'{bot.l10n_guild(message.guild,"hash-chmention")}:{message.channel.mention}\n{bot.l10n_guild(message.guild,"hash-chname")}:{message.channel.name}')
                        embed.add_field(name=bot.l10n_guild(message.guild,"hash-link"), value=message.jump_url)
                        embed.set_author(name=message.author.display_name, icon_url=message.author.avatar_url_as(static_format='png'))
                        if not message.attachments == [] and (not message.attachments[0].is_spoiler()):
                            embed.set_image(url=message.attachments[0].url)
                    await sch.send(embed=embed)


async def dlevel(message,gs):
    if "clevel" in gs["lockcom"]:
        return
    if message.author.bot:
        return
    if gs["levels"].get(str(message.author.id),None) is None:
        gs["levels"][str(message.author.id)]={
            "level":0,
            "exp":random.randint(5,15),
            "lltime":int(time.time()),
            "dlu":True
        }
        bot.cursor.execute("UPDATE guilds SET levels = ? WHERE id = ?", (gs["levels"],message.guild.id))
    else:
        if gs["levels"][str(message.author.id)]["dlu"]:
            if (int(time.time())-gs["levels"][str(message.author.id)]["lltime"]) >= 60:
                gs["levels"][str(message.author.id)]["lltime"]=int(time.time())
                gs["levels"][str(message.author.id)]["exp"] += random.randint(5,15)
                if gs["levels"][str(message.author.id)]["exp"] >= gs["levels"][str(message.author.id)]["level"] ** 3 + 20:
                    gs["levels"][str(message.author.id)]["exp"] -= gs["levels"][str(message.author.id)]["level"] ** 3 + 20
                    gs["levels"][str(message.author.id)]["level"] += 1
                    aut = str(message.author).replace("\\","\\\\").replace("*","\*").replace("_","\_").replace("|","\|").replace("~","\~").replace("`","\`").replace(">","\>")
                    if gs["levelupsendto"]:
                        c=bot.get_channel(gs["levelupsendto"])
                        try:
                            m = await c.send(str(bot.get_emoji(653161518212448266))+bot._(message.author,"levelup-notify",aut,gs["levels"][str(message.author.id)]["level"]))
                            await asyncio.sleep(1)
                            await m.edit(content=str(bot.get_emoji(653161518212448266))+bot._(message.author,"levelup-notify",message.author.mention,gs["levels"][str(message.author.id)]["level"]))
                        except:
                            pass
                    else:
                        try:
                            m = await message.channel.send(str(bot.get_emoji(653161518212448266))+bot._(message.author,"levelup-notify",aut,gs["levels"][str(message.author.id)]["level"]))
                            await asyncio.sleep(1)
                            await m.edit(content=str(bot.get_emoji(653161518212448266))+bot._(message.author,"levelup-notify",message.author.mention,gs["levels"][str(message.author.id)]["level"]))
                        except:
                            pass
                    try:
                        if gs["reward"].get(str(gs["levels"][str(message.author.id)]["level"]),None):
                            rl = message.guild.get_role(gs["reward"][str(gs["levels"][str(message.author.id)]["level"])])
                            await message.author.add_roles(rl)
                    except:
                        pass
                bot.cursor.execute("UPDATE guilds SET levels = ? WHERE id = ?", (gs["levels"],message.guild.id))

@commands.is_owner()
@bot.command()
async def ldb(ctx,name):
    bot.cursor.execute(f"select * from {name}")
    sddb = bot.cursor.fetchall()
    await ctx.send(f"{len(sddb)}")

@commands.is_owner()
@bot.command()
async def mentdb(ctx):
    bot.cursor.execute(f"select * from users")
    sddb = bot.cursor.fetchall()
    async with ctx.channel.typing():
        for ctt in sddb:
            if not (ctt["id"] in [i.id for i in bot.users]):
                bot.cursor.execute(f"delete from users where id = {ctt['id']}")
    await ctx.send("å®Œäº†ã—ã¾ã—ãŸâ˜†")


@bot.command()
async def vpc(ctx):
    await ctx.send(embed=ut.getEmbed("post count",str([f"{k}:{v}" for k,v in postcount.items()])))

@bot.command()
async def rnotify(ctx,ch:int=None):
    if ctx.author.guild_permissions.administrator or ctx.author.id == 404243934210949120:
        tchid = ch or ctx.channel.id
        tch =  bot.get_channel(tchid)
        fch = bot.get_channel(667351221106901042)
        await fch.follow(destination=tch)
        await ctx.send("ãƒ•ã‚©ãƒ­ãƒ¼ãŒå®Œäº†ã—ã¾ã—ãŸã€‚")
    else:
        await ctx.send("ã‚µãƒ¼ãƒãƒ¼ç®¡ç†è€…ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚")

@bot.command()
async def rtopic(ctx,ch:int=None):
    if ctx.author.guild_permissions.administrator or ctx.author.id == 404243934210949120:
        tchid = ch or ctx.channel.id
        tch =  bot.get_channel(tchid)
        fch = bot.get_channel(677862542298710037)
        await fch.follow(destination=tch)
        await ctx.send("ãƒ•ã‚©ãƒ­ãƒ¼ãŒå®Œäº†ã—ã¾ã—ãŸã€‚")
    else:
        await ctx.send("ã‚µãƒ¼ãƒãƒ¼ç®¡ç†è€…ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚")


bot.remove_command('help')

@bot.command()
async def ehelp(ctx,rcmd=None):
    #è‹±èªãƒ˜ãƒ«ãƒ—ç”¨
    if rcmd == None:
        page = 1
        embed = discord.Embed(title=ctx._("help-1-t"), description=ctx._("help-1-d"), color=bot.ec)
        embed.set_footer(text=f"page:{page}")
        msg = await ctx.send(embed=embed)
        await msg.add_reaction(bot.get_emoji(653161518195671041))
        await msg.add_reaction(bot.get_emoji(653161518170505216))
        await msg.add_reaction("ğŸ”")
        while True:
            try:
                r, u = await bot.wait_for("reaction_add", check=lambda r,u: r.message.id==msg.id and u.id == ctx.message.author.id,timeout=30)
            except:
                break
            try:
                await msg.remove_reaction(r,u)
            except:
                pass
            if str(r) == str(bot.get_emoji(653161518170505216)):
                if page == 14:
                    page = 1
                else:
                    page = page + 1
                embed = discord.Embed(title=ctx._(f"help-{page}-t"), description=ctx._(f"help-{page}-d"), color=bot.ec)
                embed.set_footer(text=f"page:{page}")
                await msg.edit(embed=embed)
            elif str(r) == str(bot.get_emoji(653161518195671041)):
                if page == 1:
                    page = 14
                else:
                    page = page - 1
                embed = discord.Embed(title=ctx._(f"help-{page}-t"), description=ctx._(f"help-{page}-d"), color=bot.ec)
                embed.set_footer(text=f"page:{page}")
                await msg.edit(embed=embed)
            elif str(r) == "ğŸ”":
                await msg.remove_reaction(bot.get_emoji(653161518195671041),bot.user)
                await msg.remove_reaction("ğŸ”",bot.user)
                await msg.remove_reaction(bot.get_emoji(653161518170505216),bot.user)
                qm = await ctx.send(ctx._("help-s-send"))
                try:
                    msg = await bot.wait_for('message', check=lambda m: m.author==ctx.author and m.channel==ctx.channel,timeout=60)
                    sewd = msg.content
                except asyncio.TimeoutError:
                    pass
                else:
                    try:
                        await msg.delete()
                        await qm.delete()
                    except:
                        pass
                    async with ctx.message.channel.typing():
                        lang = ctx.user_lang() or "ja"
                        with open(f"lang/{lang}.json","r",encoding="utf-8") as j:
                            f = json.load(j)
                        sre = discord.Embed(title=ctx._("help-s-ret-title"),description=ctx._("help-s-ret-desc", sewd),color=bot.ec)
                        for k,v in f.items():
                            if k.startswith("h-"):
                                if sewd in k.replace("h-","")  or sewd in v:
                                    sre.add_field(name=k.replace("h-",""),value=v.replace(sewd,f"**{sewd}**"))
                    await ctx.send(embed=sre)
        try:
            await msg.remove_reaction(bot.get_emoji(653161518195671041),bot.user)
            await msg.remove_reaction("ğŸ”",bot.user)
            await msg.remove_reaction(bot.get_emoji(653161518170505216),bot.user)
        except:
            pass
    else:
        embed = discord.Embed(title=str(rcmd), description=ctx._(f"h-{str(rcmd)}"), color=bot.ec)
        if embed.description == "":
            await ctx.send(ctx._("h-notfound"))
        else:
            await ctx.send(embed=embed)


@bot.command()
async def help(ctx,rcmd=None):
    #ãƒ˜ãƒ«ãƒ—å†…å®¹
    if rcmd == None:
        page = 1
        embed = discord.Embed(title=ctx._("help-1-t"), description=ctx._("help-1-d"), color=bot.ec)
        embed.set_footer(text=f"page:{page}")
        msg = await ctx.send(embed=embed)
        await msg.add_reaction(bot.get_emoji(653161518195671041))
        await msg.add_reaction(bot.get_emoji(653161518170505216))
        await msg.add_reaction("ğŸ”")
        while True:
            try:
                r, u = await bot.wait_for("reaction_add", check=lambda r,u: r.message.id==msg.id and u.id == ctx.message.author.id,timeout=30)
            except:
                break
            try:
                await msg.remove_reaction(r,u)
            except:
                pass
            if str(r) == str(bot.get_emoji(653161518170505216)):
                if page == 16:
                    page = 1
                else:
                    page = page + 1
                embed = discord.Embed(title=ctx._(f"help-{page}-t"), description=ctx._(f"help-{page}-d"), color=bot.ec)
                embed.set_footer(text=f"page:{page}")
                await msg.edit(embed=embed)
            elif str(r) == str(bot.get_emoji(653161518195671041)):
                if page == 1:
                    page = 16
                else:
                    page = page - 1
                embed = discord.Embed(title=ctx._(f"help-{page}-t"), description=ctx._(f"help-{page}-d"), color=bot.ec)
                embed.set_footer(text=f"page:{page}")
                await msg.edit(embed=embed)
            elif str(r) == "ğŸ”":
                await msg.remove_reaction(bot.get_emoji(653161518195671041),bot.user)
                await msg.remove_reaction("ğŸ”",bot.user)
                await msg.remove_reaction(bot.get_emoji(653161518170505216),bot.user)
                qm = await ctx.send(ctx._("help-s-send"))
                try:
                    msg = await bot.wait_for('message', check=lambda m: m.author==ctx.author and m.channel==ctx.channel,timeout=60)
                    sewd = msg.content
                except asyncio.TimeoutError:
                    pass
                else:
                    try:
                        await msg.delete()
                        await qm.delete()
                    except:
                        pass
                    async with ctx.message.channel.typing():
                        lang = ctx.user_lang() or "ja"
                        with open(f"lang/{lang}.json","r",encoding="utf-8") as j:
                            f = json.load(j)
                        sre = discord.Embed(title=ctx._("help-s-ret-title"),description=ctx._("help-s-ret-desc", sewd),color=bot.ec)
                        for k,v in f.items():
                            if k.startswith("nh-"):
                                if sewd in k.replace("nh-","")  or sewd in str(v):
                                    sre.add_field(name=k.replace("nh-",""),value=f"è©³ç´°ã‚’è¦‹ã‚‹ã«ã¯`s-help {k.replace('nh-','')}`ã¨é€ä¿¡")
                    await ctx.send(embed=sre)
        try:
            await msg.remove_reaction(bot.get_emoji(653161518195671041),bot.user)
            await msg.remove_reaction("ğŸ”",bot.user)
            await msg.remove_reaction(bot.get_emoji(653161518170505216),bot.user)
        except:
            pass
    else:
        dcmd = ctx._(f"nh-{str(rcmd)}")
        if str(dcmd) == "":
            await ctx.send(ctx._("h-notfound"))
        else:
            embed = ut.getEmbed(dcmd[0],dcmd[1],bot.ec,*dcmd[2:])
            await ctx.send(embed=embed)

@bot.event
async def on_command(ctx):
    ch=bot.get_channel(693048961107230811)
    e=discord.Embed(title=f"{ctx.command.name}ã®å®Ÿè¡Œ",description=f"å®Ÿè¡Œæ–‡:`{ctx.message.clean_content}`",color=bot.ec)
    e.set_author(name=f"å®Ÿè¡Œè€…:{str(ctx.author)}({ctx.author.id})",icon_url=ctx.author.avatar_url_as(static_format="png"))
    e.set_footer(text=f"å®Ÿè¡Œã‚µãƒ¼ãƒãƒ¼:{ctx.guild.name}({ctx.guild.id})",icon_url=ctx.guild.icon_url_as(static_format="png"))
    e.add_field(name="æˆåŠŸã—ãŸã‹",value=str(not ctx.command_failed))
    e.add_field(name="å®Ÿè¡Œãƒãƒ£ãƒ³ãƒãƒ«",value=ctx.channel.name)
    e.timestamp = ctx.message.created_at
    await ch.send(embed=e)


@bot.event
async def on_command_error(ctx, error):
    #await ctx.send(f"{error}")
    #global DoServercmd
    """if isinstance(error, commands.CommandNotFound):
        if not DoServercmd:
            embed = discord.Embed(title=ctx._("cmd-error-t"), description=ctx._("cmd-notfound-d"), color=bot.ec)
            DoServercmd = False
            await ctx.send(embed=embed)
    el"""
    if isinstance(error,commands.CommandOnCooldown):
        #ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
        embed = discord.Embed(title=ctx._("cmd-error-t"), description=ctx._("cmd-cooldown-d", str(error.retry_after)[:4]), color=bot.ec)
        await ctx.send(embed=embed)
    elif isinstance(error,commands.NotOwner):
        #ã‚ªãƒ¼ãƒŠãƒ¼å°‚ç”¨ã‚³ãƒãƒ³ãƒ‰
        embed = discord.Embed(title=ctx._("cmd-error-t"), description=ctx._("only-mii-10"), color=bot.ec)
        await ctx.send(embed=embed)
        ch=bot.get_channel(652127085598474242)
        await ch.send(embed=ut.getEmbed("ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°",f"ã‚³ãƒãƒ³ãƒ‰:`{ctx.command.name}`\n```{str(error)}```",bot.ec,f"ã‚µãƒ¼ãƒãƒ¼",ctx.guild.name,"å®Ÿè¡Œãƒ¡ãƒ³ãƒãƒ¼",ctx.author.name,"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹",ctx.message.content))
    elif isinstance(error,commands.MissingRequiredArgument):
        #å¼•æ•°ãŒãªã„ã‚ˆã£â˜†
        embed = discord.Embed(title=ctx._("cmd-error-t"), description=ctx._("pls-arg"), color=bot.ec)
        await ctx.send(embed=embed)
    else:
        #ãã®ä»–ä¾‹å¤–
        ch=bot.get_channel(652127085598474242)
        await ch.send(embed=ut.getEmbed("ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°",f"ã‚³ãƒãƒ³ãƒ‰:`{ctx.command.name}`\n```{str(error)}```",bot.ec,f"ã‚µãƒ¼ãƒãƒ¼",ctx.guild.name,"å®Ÿè¡Œãƒ¡ãƒ³ãƒãƒ¼",ctx.author.name,"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹",ctx.message.content))

"""

@tasks.loop(time=datetime.time(hour=23,minute=0,second=0))
async def invite_tweet():
    try:
        bot.twi.statuses.update(status=f"[å®šæœŸæŠ•ç¨¿]\nã¿ãƒã¦ã‚“â˜†ã®å…¬é–‹Discordã‚µãƒ¼ãƒãƒ¼:https://discord.gg/GbHq7fz\nã¿ãƒã¦ã‚“â˜†åˆ¶ä½œã€å¤šæ©Ÿèƒ½Discordbotæ€æƒŸå¥ˆã¡ã‚ƒã‚“:https://discordapp.com/oauth2/authorize?client_id=462885760043843584&permissions=8&scope=bot\n<ã“ã®æŠ•ç¨¿ã¯æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã‚ˆã‚Šè¡Œã‚ã‚Œã¾ã—ãŸã€‚>")
    except:
        dc=bot.get_user(404243934210949120)
        await dc.send(f"have error:```{traceback.format_exc(1)}```")

@tasks.loop(time=datetime.time(hour=8,minute=0,second=0))
async def now_sina_tweet():
    try:
        bot.twi.statuses.update(status=f"[å®šæœŸæŠ•ç¨¿]\næ€æƒŸå¥ˆã¡ã‚ƒã‚“ã®ã„ã‚‹ã‚µãƒ¼ãƒãƒ¼æ•°:{len(bot.guilds)}\næ€æƒŸå¥ˆã¡ã‚ƒã‚“ã®å…¬å¼ã‚µãƒ¼ãƒãƒ¼:https://discord.gg/udA3qgZ\n<ã“ã®æŠ•ç¨¿ã¯æ€æƒŸå¥ˆã¡ã‚ƒã‚“ã‚ˆã‚Šè¡Œã‚ã‚Œã¾ã—ãŸã€‚>")
    except:
        dc=bot.get_user(404243934210949120)
        await dc.send(f"have error:```{traceback.format_exc(1)}```")
    pr=random.choice(bot.partnerg)
    if pr[3]!="":
        e=ut.getEmbed("ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚µãƒ¼ãƒãƒ¼ç´¹ä»‹",f"{bot.get_guild(pr[0])}\n{pr[3]}\nå‚åŠ : {pr[2]}")
        bot.cursor.execute("select * from globalchs where name=?",("main",))
        chs = bot.cursor.fetchone()
        for chid in chs["ids"]:
            try:
                ch = bot.get_channel(chid)
                for wh in await ch.webhooks():
                    try:
                        if wh.name == "sina_global":
                            await wh.send(embed=e)
                            await asyncio.sleep(0.2)
                            break
                    except:
                        continue
            except:
                pass

"""

from cogs import apple_invite
apple_invite.setup(bot)
apple_foc.setup(bot)

#é€šå¸¸ãƒˆãƒ¼ã‚¯ãƒ³
bot.run(bot.BOT_TOKEN)

#ãƒ†ã‚¹ãƒˆãƒˆãƒ¼ã‚¯ãƒ³
#bot.run(bot.BOT_TEST_TOKEN)
